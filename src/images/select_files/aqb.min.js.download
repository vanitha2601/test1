var getTransmitterPoint,getReceiverPoint,theChart,SummarizeStatistic,formatNumber,buildNodesArgs,getMouse,snapToNode,getConnectorParameters,getConnectorParametersFromCoords,_dragged,drawOrUpdateConnector,_dataSubscription;(function(n){function r(){var n=document.createElement("input"),t="onpaste";return n.setAttribute(t,""),"function"==typeof n[t]?"paste":"input"}var t,u=r()+".mask",i=navigator.userAgent,f=/iphone/i.test(i),e=/android/i.test(i);n.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"};n.fn.extend({caret:function(n,t){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof n?(t="number"==typeof t?t:n,this.each(function(){this.setSelectionRange?this.setSelectionRange(n,t):this.createTextRange&&(i=this.createTextRange(),i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",n),i.select())})):(this[0].setSelectionRange?(n=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),n=0-i.duplicate().moveStart("character",-1e5),t=n+i.text.length),{begin:n,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(i,r){var a,l,o,h,c,s;return!i&&this.length>0?(a=n(this[0]),a.data(n.mask.dataName)()):(r=n.extend({placeholder:n.mask.placeholder,completed:null},r),l=n.mask.definitions,o=[],h=s=i.length,c=null,n.each(i.split(""),function(n,t){"?"==t?(s--,h=n):l[t]?(o.push(RegExp(l[t])),null===c&&(c=o.length-1)):o.push(null)}),this.trigger("unmask").each(function(){function y(n){for(;s>++n&&!o[n];);return n}function g(n){for(;--n>=0&&!o[n];);return n}function d(n,t){var u,i;if(!(0>n)){for(u=n,i=y(t);s>u;u++)if(o[u]){if(!(s>i&&o[u].test(v[i])))break;v[u]=v[i];v[i]=r.placeholder;i=y(i)}p();a.caret(Math.max(c,n))}}function nt(n){for(var u,f,t=n,i=r.placeholder;s>t;t++)if(o[t]){if(u=y(t),f=v[t],v[t]=i,!(s>u&&o[u].test(f)))break;i=f}}function tt(n){var u,i,t,r=n.which;8===r||46===r||f&&127===r?(u=a.caret(),i=u.begin,t=u.end,0==t-i&&(i=46!==r?g(i):t=y(i-1),t=46===r?y(t):t),b(i,t),d(i,t-1),n.preventDefault()):27==r&&(a.val(k),a.caret(0,w()),n.preventDefault())}function it(t){var u,h,f,c=t.which,i=a.caret();t.ctrlKey||t.altKey||t.metaKey||32>c||c&&(0!=i.end-i.begin&&(b(i.begin,i.end),d(i.begin,i.end-1)),u=y(i.begin-1),s>u&&(h=String.fromCharCode(c),o[u].test(h)&&(nt(u),v[u]=h,p(),f=y(u),e?setTimeout(n.proxy(n.fn.caret,a,f),0):a.caret(f),r.completed&&f>=s&&r.completed.call(a))),t.preventDefault())}function b(n,t){for(var i=n;t>i&&s>i;i++)o[i]&&(v[i]=r.placeholder)}function p(){a.val(v.join(""))}function w(n){var t,f,i=a.val(),u=-1;for(t=0,pos=0;s>t;t++)if(o[t]){for(v[t]=r.placeholder;pos++<i.length;)if(f=i.charAt(pos-1),o[t].test(f)){v[t]=f;u=t;break}if(pos>i.length)break}else v[t]===i.charAt(pos)&&t!==h&&(pos++,u=t);return n?p():h>u+1?(a.val(""),b(0,s)):(p(),a.val(a.val().substring(0,u+1))),h?t:c}var a=n(this),v=n.map(i.split(""),function(n){if("?"!=n)return l[n]?r.placeholder:n}),k=a.val();a.data(n.mask.dataName,function(){return n.map(v,function(n,t){return o[t]&&n!=r.placeholder?n:null}).join("")});a.attr("readonly")||a.one("unmask",function(){a.unbind(".mask").removeData(n.mask.dataName)}).bind("focus.mask",function(){clearTimeout(t);var n;k=a.val();n=w();t=setTimeout(function(){p();n==i.length?a.caret(0,n):a.caret(n)},10)}).bind("blur.mask",function(){w();a.val()!=k&&a.change()}).bind("keydown.mask",tt).bind("keypress.mask",it).bind(u,function(){setTimeout(function(){var n=w(!0);a.caret(n);r.completed&&n==a.val().length&&r.completed.call(a)},0)});w()}))}})})(jQuery),function(n){typeof define=="function"&&define.amd?define(["jquery"],n):n(window.jQuery)}(function(n){n.fn.numeric=function(t,i){typeof t=="boolean"&&(t={decimal:t,negative:!0,decimalPlaces:-1});t=t||{};typeof t.negative=="undefined"&&(t.negative=!0);var r=t.decimal===!1?"":t.decimal||".",u=t.negative===!0?!0:!1,f=typeof t.decimalPlaces=="undefined"?-1:t.decimalPlaces;return i=typeof i=="function"?i:function(){},this.data("numeric.decimal",r).data("numeric.negative",u).data("numeric.callback",i).data("numeric.decimalPlaces",f).keypress(n.fn.numeric.keypress).keyup(n.fn.numeric.keyup).blur(n.fn.numeric.blur)};n.fn.numeric.keypress=function(t){var u=n.data(this,"numeric.decimal"),h=n.data(this,"numeric.negative"),o=n.data(this,"numeric.decimalPlaces"),i=t.charCode?t.charCode:t.keyCode?t.keyCode:0,r,f;if(i==13&&this.nodeName.toLowerCase()=="input")return!0;if(i==13||i==35||i==36||i==37)return!1;if((r=!1,t.ctrlKey&&i==97||t.ctrlKey&&i==65)||t.ctrlKey&&i==120||t.ctrlKey&&i==88||t.ctrlKey&&i==99||t.ctrlKey&&i==67||t.ctrlKey&&i==122||t.ctrlKey&&i==90||t.ctrlKey&&i==118||t.ctrlKey&&i==86||t.shiftKey&&i==45)return!0;if(i<48||i>57){if(f=n(this).val(),n.inArray("-",f.split(""))!==0&&h&&i==45&&(f.length===0||parseInt(n.fn.getSelectionStart(this),10)===0))return!0;u&&i==u.charCodeAt(0)&&n.inArray(u,f.split(""))!=-1&&(r=!1);i!=8&&i!=9&&i!=13&&i!=35&&i!=36&&i!=37&&i!=39&&i!=46?r=!1:typeof t.charCode!="undefined"&&(t.keyCode==t.which&&t.which!==0?(r=!0,t.which==46&&(r=!1)):t.keyCode!==0&&t.charCode===0&&t.which===0&&(r=!0));u&&i==u.charCodeAt(0)&&(r=n.inArray(u,f.split(""))==-1?!0:!1)}else if(r=!0,u&&o>0){var s=n.fn.getSelectionStart(this),c=n.fn.getSelectionEnd(this),e=n.inArray(u,n(this).val().split(""));s===c&&e>=0&&s>e&&n(this).val().length>e+o&&(r=!1)}return r};n.fn.numeric.keyup=function(){var t=n(this).val(),c,l,i,o,a,s,v,f,p,u;if(t&&t.length>0){var h=n.fn.getSelectionStart(this),e=n.fn.getSelectionEnd(this),r=n.data(this,"numeric.decimal"),w=n.data(this,"numeric.negative"),y=n.data(this,"numeric.decimalPlaces");for(r!==""&&r!==null&&(u=n.inArray(r,t.split("")),u===0&&(this.value="0"+t,h++,e++),u==1&&t.charAt(0)=="-"&&(this.value="-0"+t.substring(1),h++,e++),t=this.value),c=[0,1,2,3,4,5,6,7,8,9,"-",r],l=t.length,i=l-1;i>=0;i--){for(o=t.charAt(i),i!==0&&o=="-"?t=t.substring(0,i)+t.substring(i+1):i!==0||w||o!="-"||(t=t.substring(1)),a=!1,s=0;s<c.length;s++)if(o==c[s]){a=!0;break}a&&o!=" "||(t=t.substring(0,i)+t.substring(i+1))}if(v=n.inArray(r,t.split("")),v>0)for(f=l-1;f>v;f--)p=t.charAt(f),p==r&&(t=t.substring(0,f)+t.substring(f+1));r&&y>0&&(u=n.inArray(r,t.split("")),u>=0&&(t=t.substring(0,u+y+1),e=Math.min(t.length,e)));this.value=t;n.fn.setSelection(this,[h,e])}};n.fn.numeric.blur=function(){var u=n.data(this,"numeric.decimal"),f=n.data(this,"numeric.callback"),t=n.data(this,"numeric.negative"),i=this.value,r;i!==""&&(r=new RegExp("^"+(t?"-?":"")+"\\d+$|^"+(t?"-?":"")+"\\d*"+u+"\\d+$"),r.exec(i)||f.apply(this))};n.fn.removeNumeric=function(){return this.data("numeric.decimal",null).data("numeric.negative",null).data("numeric.callback",null).data("numeric.decimalPlaces",null).unbind("keypress",n.fn.numeric.keypress).unbind("keyup",n.fn.numeric.keyup).unbind("blur",n.fn.numeric.blur)};n.fn.getSelectionStart=function(n){if(n.type==="number")return undefined;if(n.createTextRange&&document.selection){var t=document.selection.createRange().duplicate();return(t.moveEnd("character",n.value.length),t.text=="")?n.value.length:Math.max(0,n.value.lastIndexOf(t.text))}try{return n.selectionStart}catch(i){return 0}};n.fn.getSelectionEnd=function(n){if(n.type==="number")return undefined;if(n.createTextRange&&document.selection){var t=document.selection.createRange().duplicate();return t.moveStart("character",-n.value.length),t.text.length}return n.selectionEnd};n.fn.setSelection=function(n,t){if(typeof t=="number"&&(t=[t,t]),t&&t.constructor==Array&&t.length==2)if(n.type==="number")n.focus();else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveStart("character",t[0]);i.moveEnd("character",t[1]-t[0]);i.select()}else{n.focus();try{n.setSelectionRange&&n.setSelectionRange(t[0],t[1])}catch(r){}}}}),function(n){n.QueryString=function(n){var r,t,i;if(n=="")return{};for(r={},t=0;t<n.length;++t)(i=n[t].split("="),i.length==2)&&(r[i[0]]=decodeURIComponent(i[1].replace(/\+/g," ")));return r}(window.location.search.substr(1).split("&"))}(jQuery);Array.prototype.find||(Array.prototype.find=function(n){var t;if(this===null)throw new TypeError("Array.prototype.find called on null or undefined");if(typeof n!="function")throw new TypeError("predicate must be a function");var i=Object(this),u=i.length>>>0,f=arguments[1],r;for(t=0;t<u;t++)if(r=i[t],n.call(f,r,t,i))return r;return undefined});Array.prototype.move=function(n,t){var i,r;if(t>=this.length)for(i=t-this.length;i--+1;)this.push(undefined);return r=this.splice(n,1)[0],t>n&&t--,this.splice(t,0,r),this};utils={};utils.CreateGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})};utils.FormatDateTime=function(n,t){return n!=undefined&&t!=undefined?moment(n).format("YYYY-MM-DD")+" "+t:null};utils.GetParameterByName=function(n){n=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+n+"=([^&#]*)"),t=i.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))};utils.GetHiddenValByName=function(n){return $("input[name='"+n+"']").val()};utils.RenderChart=function(n,t,i,r,u,f){var ft,h,s,e,l,tt,p,yt,c,ot,y,k,nt,st;if(t&&t.length>0){var g=$(n).innerWidth(),ct=460,o={top:20,right:20,bottom:40,left:50};g-o.left-o.right>600&&(ft=Math.floor((g-o.left-o.right-600)/2),o.left+=ft,o.right+=ft);h=g-o.left-o.right;s=400;switch(i){case"Line Chart":e=t.slice();e.sort(function(n,t){return n[r]<t[r]?-1:n[r]>t[r]?1:0});tools.IsDatetimeType(u)?(p=function(n){return new Date(n[r])},l=d3.time.scale().domain(d3.extent(e,p)).range([0,h]),tt=d3.svg.axis().scale(l).orient("bottom").ticks(5)):(p=function(n){return n[r]},l=d3.scale.linear().domain(d3.extent(e,p)).range([0,h]),tt=d3.svg.axis().scale(l).orient("bottom").ticks(5));var a=function(n){return n[f]},lt=0,at=Math.max.apply(null,e.map(a)),w=d3.scale.linear().domain([lt,at]).range([s,0]),vt=d3.svg.axis().scale(w).orient("left").ticks(5),et=$(n).empty(),it=d3.select("#"+et.attr("id")).append("svg").attr("width",g).attr("height",ct),b=it.append("g").attr("transform","translate("+o.left+","+o.top+")"),v=b.append("g").attr("transform","translate(0,"+s+")");v.call(tt);v.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges");v.selectAll("text").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px");c=b.append("g");c.call(vt);c.selectAll("text").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px");c.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges");yt=d3.svg.line().x(function(n){return l(p(n))}).y(function(n){return w(a(n))});b.append("path").datum(e).attr("fill","none").attr("d",yt).attr("stroke","rgb(100, 100, 255)").attr("stroke-width","1px");break;case"Bar Chart":var p=function(n){return n[r]},a=function(n){return n[f]},e=t.slice(0,25),l=d3.scale.ordinal().domain(d3.range(e.length)).rangeRoundPoints([0,h],1),tt=d3.svg.axis().scale(l).orient("bottom").ticks(e.length).tickFormat(function(n){return p(e[n])}),lt=0,at=Math.max.apply(null,e.map(a)),w=d3.scale.linear().domain([lt,at]).range([s,0]),vt=d3.svg.axis().scale(w).orient("left").ticks(5),et=$(n).empty(),it=d3.select("#"+et.attr("id")).append("svg").attr("width",g).attr("height",ct),b=it.append("g").attr("transform","translate("+o.left+","+o.top+")"),v=b.append("g").attr("transform","translate(0,"+s+")");if(v.call(tt),v.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges"),v.selectAll(".domain").attr("stroke","none"),v.selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px"),c=b.append("g"),c.call(vt),c.selectAll("text").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px"),c.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges"),ot=0,y=h/e.length,e.length>1){for(k=l.range(),y=k[1]-k[0],nt=1;nt+1<e.length;nt++)st=k[nt+1]-k[nt],st<y&&(y=st);ot=k[0]-y/2}var pt=b.append("g").selectAll("g").data(e).enter().append("g").attr("transform",function(n,t){return"translate("+(ot+t*y)+",0)"}),ht=6,wt=y-2*ht;pt.append("rect").attr("x",ht).attr("y",function(n){return w(a(n))}).attr("height",function(n){return s-w(a(n))}).attr("width",wt-1).on("mouseover",function(){d3.select(this.parentNode).selectAll("rect").attr("opacity",.8);d3.select(this.parentNode).selectAll("text").attr("fill","black")}).on("mouseout",function(){d3.select(this.parentNode).selectAll("rect").attr("opacity",1);d3.select(this.parentNode).selectAll("text").attr("fill","none")}).attr("fill","rgb(255, 100, 100)");pt.append("text").attr("text-anchor","middle").attr("fill","none").attr("x",ht+.5*wt).attr("y",function(n){return w(a(n))-3}).text(function(n){return a(n)});it.attr("height",$("svg > g").get(0).getBBox().height+6);$(".bar").css("background-color","Red");break;case"Pie Chart":var d=Math.min(h,s)/2,bt=t.slice(0,25),rt=bt.reduce(function(n,t){return n+t[f]},0),ut=0,e=[];$.each(bt,function(n,t){if(rt!=0){var i=100*t[f]/rt;i>=1?e.push([t[r],t[f],i,!1]):ut+=t[f]}else e.push([t[r],t[f],null,!1])});ut>0&&e.push(["Other",ut,rt!=0?ut/rt:null,!0]);e.sort(function(n,t){return n[1]<t[1]?-1:n[1]>t[1]?1:0});var p=function(n){return n[r]},a=function(n){return n[f]},gt=d3.layout.pie().sort(null).startAngle(-.25*Math.PI).endAngle(1.75*Math.PI).value(function(n){return n[1]}),kt=d3.svg.arc().outerRadius(d*.8).innerRadius(d*.4),ni=d3.svg.arc().outerRadius(d*.9).innerRadius(d*.9),et=$(n).empty(),it=d3.select("#"+et.attr("id")).append("svg").attr("width",h+o.left+o.right).attr("height",s+o.top+o.bottom),ti=it.append("g").attr("transform","translate("+(o.left+h/2)+","+(o.top+s/2)+")"),ii=d3.svg.line().x(function(n){return n[0]}).y(function(n){return n[1]}).interpolate("linear"),ri=function(n){var t=n.data[0];return t+(" ("+n.data[1]+")")},dt=["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00","#7283a2"],ui="#BBB";$.each(gt(e),function(n,t){var i=ti.append("g"),e=kt.centroid(t),r=ni.centroid(t),f=r[0]<0,u=[f?-d:d,r[1]],o=i.append("path").attr("fill",t.data[3]?ui:dt[n%dt.length]).attr("d",kt(t)),s=i.append("path").attr("d",ii([e,r,u])).attr("stroke","black").attr("stroke-width",1).attr("fill","none"),h=i.append("text").text(ri(t)).attr("x",u[0]).attr("y",u[1]).attr("text-anchor",f?"end":"start").attr("alignment-baseline","middle")});break;default:$(n).empty()}}else $(n).empty()};backend={baseUri:""},function(){backend.CheckConnection=function(n,t){var i=utils.GetHiddenValByName("DatabaseConnectionID");$.getJSON(backend.baseUri+"/api/connections/"+i+"/status/",function(n){t(n)})};backend.LoadTables=function(n){var t=utils.GetHiddenValByName("DatabaseConnectionID");$.getJSON(backend.baseUri+"/api/connections/"+t+"/tables/",function(t){n(t)}).fail(function(){n([])})};backend.GetJoins=function(n,t){var i=utils.GetHiddenValByName("DatabaseConnectionID");$.getJSON(backend.baseUri+"/api/connections/"+i+"/tables/"+n+"/joins/",function(n){t(n)}).fail(function(){t([])})};var t=!1,i=[],n=null;backend.SaveQuery=function(r,u,f){f&&i.push(f);t?n=u:(t=!0,n=null,$.ajax({url:backend.baseUri+"/api/cache/",type:"POST",data:{id:r(),databaseId:utils.GetHiddenValByName("DatabaseConnectionID"),nodes:JSON.stringify(u)},dataType:"json"}).done(function(u){if(r(u.id),t=!1,n){var f=n;n=null;backend.SaveQuery(r,f)}else while(i.length>0)i.shift()()}).fail(function(){t=!1;n=null;i.length=0}))};backend.LoadData=function(n,t,i,r,u,f,e,o){n()?$.getJSON(backend.baseUri+"/api/cache/"+n()+"/"+i+"/?startRow="+r+"&rowCount="+u,function(n){n.query&&console.log(n.query);o(n)}).fail(function(s){s.status=="404"?(n(null),backend.LoadData(n,t,i,r,u,f,e,o)):o({status:"error"})}):backend.SaveQuery(n,t,function(){backend.LoadData(n,t,i,r,u,f,e,o)})};backend.SaveSchedule=function(n,t){$.ajax({url:backend.baseUri+"/api/schedule",type:"POST",contentType:"application/json",data:JSON.stringify(n),dataType:"json"}).done(function(n){t(n)}).fail(function(n){t(n)})};backend.GetSchedule=function(n){return $.ajax({url:backend.baseUri+"/api/schedule?id="+n,type:"GET",contentType:"application/json",dataType:"json"})};backend.LoadQueryColumnsName=function(n){return $.ajax({url:backend.baseUri+"/api/queries/"+n+"/columns/",type:"GET"})}}();theChart=null;getTransmitterPoint=function(n){var t={};return t.x=n.Left()+60,t.y=n.Top()+24,t};getReceiverPoint=function(n){var t={};return t.x=n.Left()-12,t.y=n.Top()+24,t};nodes={};nodes.NodeBase=function(n){var t={};return t.Name=ko.observable(n.Name),n.Tool&&(t.Tool=n.Tool,t.SymbolPath=n.Tool.SymbolPath),t.OptionsTemplateUrl=n.OptionsTemplateUrl,t.Top=ko.observable(n.Top),t.Left=ko.observable(n.Left),t.IsSelected=ko.observable(!1),t.ColumnItems=ko.observableArray(),t.SetColumns=function(n,i){var u=[],r;if(n&&i&&n.length==i.length)for(r=0;r<n.length;r++)u.push({column_name:n[r],column_type:i[r]});t.ColumnItems(u)},t.ColumnTypes=ko.computed(function(){var n=t.ColumnItems();return n===undefined?[]:n.map(function(n){return n.column_type})}),t.Columns=ko.computed(function(){var n=t.ColumnItems();return n===undefined?[]:n.map(function(n){return n.column_name})}),t.Id=n.Id,t.Id==undefined&&(t.Id=utils.CreateGuid()),t.ErrorText=ko.observable(null),t.OnSelected=function(){},t.OnOptionsUpdated=function(){},t.IsConfigured=function(){return!0},t.GetCoreSettings=function(){return{Type:t.Tool.Name,Id:t.Id}},t.GetSaveSettings=function(){var n=t.GetCoreSettings();return n.Name=t.Name(),n.Top=t.Top(),n.Left=t.Left(),t.Columns()&&(n.Columns=t.Columns()),t.ColumnTypes()&&(n.ColumnTypes=t.ColumnTypes()),n},t.LoadSettings=function(n){t.Name(n.Name);t.Id=n.Id;t.Top(n.Top);t.Left(n.Left);t.SetColumns(n.Columns,n.ColumnTypes)},t.GetRightExtent=function(){if(t.GetTransmitterPoint){var n=t.GetTransmitterPoint();return n.x+16}return t.Left()+64},t.GetBottomExtent=function(){return t.Top()+80},t};nodes.DataSourceBase=function(n){var t=new nodes.NodeBase(n),i;return t.Type="DataSource",t.Data=ko.observableArray(),t.TotalPages=ko.computed(function(){return Math.floor(t.Data().length/10)+1}),t.CurrentPage=ko.observable(1),t.CurrentPageData=ko.computed(function(){return t.Data.slice((t.CurrentPage()-1)*10,Math.min((t.CurrentPage()-1)*10+9,t.Data().length-1))}),t.GetTransmitterPoint=function(){return getTransmitterPoint(this)},i=t.LoadSettings,t.LoadSettings=function(n,t){i(n,t)},t};nodes.DatabaseTable=function(n){var t=new nodes.DataSourceBase(n),i,r,u;return t.Tables=ko.observableArray(),t.Table=ko.observable(),t.TablesLoading=ko.observable(!1),t.Table.subscribe(function(n){(/Data Table [0-9]+/.test(t.Name())||$.inArray(t.Name(),t.Tables())>=0)&&t.Name(n)}),t.loadTables=function(n){t.Tables().length==0&&(t.TablesLoading(!0),backend.LoadTables(function(i){i.status==null&&(t.Tables(i),t.TablesLoading(!1));n&&n()}))},i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.Table=t.Table(),n},r=t.GetSaveSettings,t.GetSaveSettings=function(){var n=r();return n.Tables=t.Tables(),n},u=t.LoadSettings,t.LoadSettings=function(n,i){u(n,i);t.Tables(n.Tables);t.Table(n.Table)},t.IsConfigured=function(){return t.Tables().length>0},t.OnSelected=function(){t.loadTables()},t.RefreshTables=function(){t.Tables.removeAll();t.loadTables()},t};nodes.DataProcessorBase=function(n){var t=new nodes.NodeBase(n),i,r;return t.Type="DataProcessor",t.Data=ko.observableArray(),t.TotalPages=ko.computed(function(){return Math.floor(t.Data().length/10)+1}),t.CurrentPage=ko.observable(1),t.CurrentPageData=ko.computed(function(){return t.Data.slice((t.CurrentPage()-1)*10,Math.min((t.CurrentPage()-1)*10+9,t.Data().length))}),t.IsInputAllowed=ko.observable(!0),t.Inputs=ko.observableArray(),t.InputRefs=ko.observableArray(),t.OnInputsUpdated=function(n){t.InputRefs.removeAll();$.each(t.Inputs(),function(i,r){var u=n.GetNodeById(r);u!=null&&t.InputRefs.push(u)});t.IsInputAllowed(t.Inputs().length<t.Tool.MaxInputs);t.Inputs().length==0&&(t.ColumnItems.removeAll(),t.Data.removeAll())},t.AllInputColumns=ko.computed(function(){var n=[];return $.each(t.InputRefs(),function(t,i){i.Columns()!=undefined&&$.each(i.Columns(),function(t,i){n.push(i)})}),n}),t.NumericInputColumns=ko.computed(function(){var n=[];return $.each(t.InputRefs(),function(t,i){var r,t;if(i.ColumnItems()!=undefined)for(r=i.ColumnItems(),t=0;t<r.length;t++)tools.IsNumericType(r[t].column_type)&&n.push(r[t].column_name)}),n}),t.NumericOrDatetimeInputColumns=ko.computed(function(){var n=[];return $.each(t.InputRefs(),function(t,i){var r,t;if(i.ColumnItems()!=undefined)for(r=i.ColumnItems(),t=0;t<r.length;t++)(tools.IsNumericType(r[t].column_type)||tools.IsDatetimeType(r[t].column_type))&&n.push(r[t].column_name)}),n}),t.AllInputColumnInfos=ko.computed(function(){var n=[];return $.each(t.InputRefs(),function(t,i){i.ColumnItems()!=undefined&&$.each(i.ColumnItems(),function(t,r){n.push({InputId:i.Id,Index:t,Name:r.column_name,Type:r.column_type})})}),n}),t.NumericInputColumnInfos=ko.computed(function(){var n=[];return $.each(t.InputRefs(),function(t,i){i.ColumnItems()!=undefined&&$.each(i.ColumnItems(),function(t,r){tools.IsNumericType(r.column_type)&&n.push({InputId:i.Id,Index:t,Name:r.column_name,Type:r.column_type})})}),n}),t.GetInputColumns=function(n){return t.InputRefs().length>n?t.InputRefs()[n].Columns():[]},t.GetInputName=function(n){return t.InputRefs().length>n?t.InputRefs()[n].Name():""},i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.Inputs=t.Inputs(),n},r=t.LoadSettings,t.LoadSettings=function(n,i){r(n,i);t.Inputs(n.Inputs);t.OnInputsUpdated(i)},t.GetTransmitterPoint=function(){return getTransmitterPoint(this)},t.GetReceiverPoint=function(){return getReceiverPoint(this)},t};nodes.Join=function(n){var t=new nodes.DataProcessorBase(n),i,r;return t.JoinType=ko.observable(),t.Table1Column=ko.observable(),t.Table2Column=ko.observable(),t.Table1Columns=ko.computed(function(){return t.GetInputColumns(0)}),t.Table2Columns=ko.computed(function(){return t.GetInputColumns(1)}),t.Table1Name=ko.computed(function(){return t.GetInputName(0)}),t.Table2Name=ko.computed(function(){return t.GetInputName(1)}),i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.JoinType=t.JoinType(),n.Table1Column=t.Table1Column(),n.Table2Column=t.Table2Column(),n},r=t.LoadSettings,t.LoadSettings=function(n,i){r(n,i);t.JoinType(n.JoinType);t.Table1Column(n.Table1Column);t.Table2Column(n.Table2Column)},t.OnOptionsUpdated=function(){},t.CalculateColumns=function(){var n=t.AllInputColumnInfos(),i=n.map(function(n){return n.Name}),r=n.map(function(n){return n.Type});t.SetColumns(i,r)},t};nodes.Select=function(n){var t=new nodes.DataProcessorBase(n),i,r;return t.IncludedColumnIndexes=ko.observableArray(),t.ColumnAliases=ko.observableArray(),t.EditingPosition=ko.observable(null),t.EditColumnName=ko.observable(),i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.IncludedColumnIndexes=t.IncludedColumnIndexes(),n.ColumnAliases=t.ColumnAliases(),n},r=t.LoadSettings,t.LoadSettings=function(n,i){r(n,i);t.IncludedColumnIndexes(n.IncludedColumnIndexes||[]);t.ColumnAliases(n.ColumnAliases||[])},t.GetColumnName=function(n){if(t.IncludedColumnIndexes().length>n()&&t.IncludedColumnIndexes()[n()]!=null){var r=t.IncludedColumnIndexes()[n()],i=t.AllInputColumns()[r];return t.ColumnAliases().length>n()&&t.ColumnAliases()[n()]!=null&&(i=t.ColumnAliases()[n()]),i}return""},t.EnableEditMode=function(n,i){if(t.EditingPosition()==null){var r=$(i.target).parent().prevAll().length;t.EditColumnName($(i.target).parent().find("span").text());t.EditingPosition(r)}return i.cancelBubble=!0,!1},t.FinishedEditMode=function(n,i){if(t.EditingPosition()!=null){t.ColumnAliases()[t.EditingPosition()]=t.EditColumnName();t.EditingPosition(null);t.EditColumnName(null);var r=$(i.target).parent().prevAll().length;$(i.target).parent().find("span").text(t.ColumnAliases()[r])}return i.cancelBubble=!0,!1},t.RemoveAll=function(){t.IncludedColumnIndexes.removeAll();t.ColumnAliases.removeAll()},t.AddAll=function(){t.IncludedColumnIndexes.removeAll();$.each(t.AllInputColumnInfos(),function(n,i){t.IncludedColumnIndexes.push(i.Index)})},t.RemoveItem=function(n,i){var r=$(i.target).parent().prevAll().length;t.IncludedColumnIndexes.splice(r,1);t.ColumnAliases().length>r&&t.ColumnAliases.splice(r,1)},t.IsEditing=function(n){return t.EditingPosition()===n()},t.MoveAlias=function(n,i){t.EditingPosition()!=null&&(t.EditingPosition(null),t.EditColumnName(null));t.ColumnAliases().move(n,i)},t.AddItem=function(n){t.ColumnAliases().length>n&&t.ColumnAliases().splice(n,0,null)},t.CalculateColumns=function(){var n=t.IncludedColumnIndexes().map(function(n){return t.AllInputColumnInfos()[n]}),i=n.map(function(n){return n.Name}),r=n.map(function(n){return n.Type});t.SetColumns(i,r)},t};nodes.Filter=function(n){var t=new nodes.DataProcessorBase(n),i,r;return t.FilterColumnIndex=ko.observable(),t.Operator=ko.observable(),t.FilterCompareColumnIndex=ko.observable(null),t.FilterValue1=ko.observable(),t.FilterBoolValue1=ko.observable(),t.FilterDateValue1=ko.observable(new Date),t.FilterTimeValue1=ko.observable("00:00"),t.CaseSensitive=ko.observable(),i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.FilterColumnIndex=t.FilterColumnIndex(),n.Operator=t.Operator(),t.FilterCompareColumnIndex()&&(n.FilterCompareColumnIndex=t.FilterCompareColumnIndex()),n.FilterValue1=t.FilterCompareValueIsBool()?t.FilterBoolValue1():t.FilterCompareValueIsDatetime()?utils.FormatDateTime(t.FilterDateValue1(),t.FilterTimeValue1()):t.FilterValue1(),n.CaseSensitive=t.CaseSensitive(),n},r=t.LoadSettings,t.LoadSettings=function(n,i){if(r(n,i),t.FilterColumnIndex(n.FilterColumnIndex),t.Operator(n.Operator),t.FilterCompareColumnIndex(n.FilterCompareColumnIndex),t.FilterColumnIsBool())t.FilterBoolValue1(n.FilterValue1);else if(t.FilterColumnIsDatetime()){var u=new Date(Date.parse(n.FilterValue1));t.FilterDateValue1(u);t.FilterTimeValue1(moment(u).format("HH:mm"))}else t.FilterValue1(n.FilterValue1);t.CaseSensitive(n.CaseSensitive)},t.FilterColumnIsText=ko.computed(function(){var n=t.AllInputColumnInfos()[t.FilterColumnIndex()];return n!=null&&tools.IsTextType(n.Type)?!0:!1}),t.FilterColumnIsBool=ko.computed(function(){var n=t.AllInputColumnInfos()[t.FilterColumnIndex()];if(n!=null&&n.Type!=null)switch(n.Type.toUpperCase()){case"BIT":case"BOOL":case"BOOLEAN":return!0;default:return!1}else return!1}),t.FilterColumnIsDatetime=ko.computed(function(){var n=t.AllInputColumnInfos()[t.FilterColumnIndex()];return n!=null&&tools.IsDatetimeType(n.Type)?!0:!1}),t.FilterColumnIsNumeric=ko.computed(function(){var n=t.AllInputColumnInfos()[t.FilterColumnIndex()];return n!=null&&tools.IsNumericType(n.Type)?!0:!1}),t.ValidOperators=ko.computed(function(){var n=[];return $.each(t.Tool.Operators(),function(i,r){(t.FilterColumnIsNumeric()&&r.number||t.FilterColumnIsText()&&r.text||t.FilterColumnIsDatetime()&&r.date||t.FilterColumnIsBool()&&r.bool)&&n.push(r)}),n}),t.ShowFilterCompareValue=ko.computed(function(){var n=t.Tool.Operators().find(function(n){return n.type==t.Operator()});return n?n.compareValue:!1}),t.FilterCompareValueIsBool=ko.computed(function(){var n=t.Tool.Operators().find(function(n){return n.type==t.Operator()});return n&&n.compareValueType?n.compareValueType=="bool":t.FilterColumnIsBool()}),t.FilterCompareValueIsDatetime=ko.computed(function(){var n=t.Tool.Operators().find(function(n){return n.type==t.Operator()});return n&&n.compareValueType?n.compareValueType=="datetime":t.FilterColumnIsDatetime()}),t.FilterCompareValueIsNumeric=ko.computed(function(){var n=t.Tool.Operators().find(function(n){return n.type==t.Operator()});return n&&n.compareValueType?n.compareValueType=="numeric":t.FilterColumnIsNumeric()}),t.ShowFilterCompareBool=ko.computed(function(){return t.ShowFilterCompareValue()&&t.FilterCompareColumnIndex()==null&&t.FilterCompareValueIsBool()}),t.ShowFilterCompareDatetime=ko.computed(function(){return t.ShowFilterCompareValue()&&t.FilterCompareColumnIndex()==null&&t.FilterCompareValueIsDatetime()}),t.ShowFilterCompareNumeric=ko.computed(function(){return t.ShowFilterCompareValue()&&t.FilterCompareColumnIndex()==null&&t.FilterCompareValueIsNumeric()}),t.ShowFilterCompareValue1=ko.computed(function(){return t.FilterCompareValueIsNumeric()==!1&&t.FilterCompareValueIsBool()==!1&&t.FilterCompareValueIsDatetime()==!1&&t.ShowFilterCompareValue()&&t.FilterCompareColumnIndex()==null}),t.ShowCaseSensitive=ko.computed(function(){var n=t.Tool.Operators().find(function(n){return n.type==t.Operator()});return t.FilterColumnIsText()&&n&&n.showCaseSensitive?!0:!1}),t.AllInputColumnsPlusEnteredValue=ko.computed(function(){var n=t.AllInputColumnInfos().slice(0);return n.splice(0,0,{Index:null,Name:"Enter a value..."}),n}),t};nodes.Sort=function(n){var t=new nodes.DataProcessorBase(n),i,r;return t.SortColumns=ko.observableArray([{SortColumn:ko.observable(),Descending:ko.observable(!1)}]),t.AddSort=function(){t.SortColumns.push({SortColumn:ko.observable(),Descending:ko.observable(!1)})},t.RemoveSort=function(n){t.SortColumns.remove(n)},t.OnOptionsUpdated=function(){},i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.SortColumns=[],n.SortDirections=[],$.each(t.SortColumns(),function(t,i){n.SortColumns.push(i.SortColumn());n.SortDirections.push(!i.Descending())}),n},r=t.LoadSettings,t.LoadSettings=function(n,i){r(n,i);t.SortColumns([]);n.SortColumn!=null&&t.SortColumns().push({SortColumn:ko.observable(n.SortColumn),Descending:ko.observable(n.Descending|!1)});n.SortColumns!=null&&$.each(n.SortColumns,function(n,i){t.SortColumns().push({SortColumn:ko.observable(i),Descending:ko.observable(!1)})});n.SortDirections!=null&&$.each(n.SortDirections,function(n,i){t.SortColumns()[n].Descending(!i)})},t};SummarizeStatistic=function(n,t,i){var u=n,r=this;return r.AggFunction=ko.observable(t),r.AggColumn=ko.observable(i),r.ShowAggColumn=ko.pureComputed(function(){var n=r.AggFunction(),t=u.Tool.AggFunctions().filter(function(t){return t.id==n})[0];return t.requiresColumn}),r.AvailableAggColumns=ko.pureComputed(function(){return u.AllInputColumnInfos().filter(function(n){var t=r.AggFunction(),i=u.Tool.AggFunctions().filter(function(n){return n.id==t})[0];return tools.IsNumericType(n.Type)||tools.IsDatetimeType(n.Type)&&i.WorksWithDates})}),r.HasColumnIndex=ko.pureComputed(function(){return!!r.AggColumn()}),r};nodes.Summarize=function(n){var t=new nodes.DataProcessorBase(n),i,r;return t.ShowGroupBy=ko.observable(!1),t.GroupByColumns=ko.observableArray(),t.Statistics=ko.observableArray(),t.ForEachColumns=ko.computed(function(){return t.AllInputColumns()}),t.GroupColumns=ko.computed(function(){return t.AllInputColumnInfos()}),t.GroupByFunctions=function(n){var i=[],r=t.GroupColumns()[n];return r&&tools.IsDatetimeType(r.Type)&&(i=t.Tool.DateFunctions()),i},i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.GroupByColumnIndexes=t.GroupByColumns().map(function(n){return n.index()}),n.GroupByFunctions=t.GroupByColumns().map(function(n){return n.groupByFunction()}),n.AggFunctions=[],n.AggColumnIndexes=[],$.each(t.Statistics(),function(t,i){n.AggFunctions.push(i.AggFunction());i.HasColumnIndex()&&n.AggColumnIndexes.push(i.AggColumn())}),n},r=t.LoadSettings,t.LoadSettings=function(n,i){var f,e,u;for(r(n,i),f=[],u=0;u<n.GroupByColumnIndexes.length;u++)n.GroupByFunctions.length>u&&f.push({index:ko.observable(n.GroupByColumnIndexes[u]),groupByFunction:ko.observable(n.GroupByFunctions[u])});for(t.GroupByColumns(f),e=[],u=0;u<n.AggFunctions.length;u++)n.AggColumnIndexes.length>u&&e.push(new SummarizeStatistic(t,n.AggFunctions[u],n.AggColumnIndexes[u]));t.Statistics(e)},t.GetColumnName=function(n){return t.AllInputColumns().length>n?t.AllInputColumns()[n]:""},t.AddStatistic=function(){t.Statistics.push(new SummarizeStatistic(t,2,0))},t.RemoveStatistic=function(n){t.Statistics.remove(n)},t.AddGroupBy=function(){t.GroupByColumns.push({index:ko.observable(0),groupByFunction:ko.observable()})},t.RemoveGroupBy=function(n){t.GroupByColumns.remove(n)},t.AddStatistic(),t};nodes.Extract=function(n){var t=new nodes.DataProcessorBase(n),i,r;return t.InputColumnIndex=ko.observable(0),t.StartType=ko.observable(1),t.StartPosition=ko.observable(1),t.StartSearch=ko.observable(""),t.EndType=ko.observable(1),t.EndPosition=ko.observable(0),t.EndSearch=ko.observable(""),t.ResultColumnName=ko.observable(""),t.ShowStartPosition=ko.computed(function(){return t.StartType()==2}),t.ShowEndPosition=ko.computed(function(){return t.EndType()==2||t.EndType()==3}),t.ShowStartSearch=ko.computed(function(){return t.StartType()>2}),t.ShowEndSearch=ko.computed(function(){return t.EndType()>3}),t.EndPositionText=ko.computed(function(){return t.EndType()==3?"Length":"Position"}),i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.InputColumnIndex=t.InputColumnIndex(),n.StartType=t.StartType(),n.StartPosition=t.StartPosition(),n.StartSearch=t.StartSearch(),n.EndType=t.EndType(),n.EndPosition=t.EndPosition(),n.EndSearch=t.EndSearch(),n.ResultColumnName=t.ResultColumnName(),n},r=t.LoadSettings,t.LoadSettings=function(n,i){r(n,i);t.InputColumnIndex(n.InputColumnIndex);t.StartType(n.StartType);t.StartPosition(n.StartPosition);t.StartSearch(n.StartSearch);t.EndType(n.EndType);t.EndPosition(n.EndPosition);t.EndSearch(n.EndSearch);t.ResultColumnName(n.ResultColumnName)},t};nodes.Append=function(n){var t=new nodes.DataProcessorBase(n),i,r;return t.IncludeUniqueColumns=ko.observable(!0),i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.IncludeUniqueColumns=t.IncludeUniqueColumns(),n},r=t.LoadSettings,t.LoadSettings=function(n,i){r(n,i);t.IncludeUniqueColumns(n.IncludeUniqueColumns)},t};nodes.DataVisualisationBase=function(n){var t=new nodes.DataProcessorBase(n);return t.Type="DataVisualisation",t.GetTransmitterPoint=undefined,t};nodes.Graph=function(n){var t=new nodes.DataVisualisationBase(n),i,r,u,f;return t.ChartTitle=ko.observable(),t.HorizontalAxis=ko.observable(),t.HorizontalAxisLabel=ko.observable(),t.VerticalAxisLabel=ko.observable(),t.DataSeriesColumnIndexes=ko.observableArray(),t.Values1=ko.observable(),i=t.GetCoreSettings,t.GetCoreSettings=function(){var n=i();return n.HorizontalAxis=t.HorizontalAxis(),n.DataSeriesColumnIndexes=t.DataSeriesColumnIndexes(),n},r=t.GetSaveSettings,t.GetSaveSettings=function(){var n=r();return n.ChartTitle=t.ChartTitle(),n.HorizontalAxisLabel=t.HorizontalAxisLabel(),n.VerticalAxisLabel=t.VerticalAxisLabel(),n},u=t.LoadSettings,t.LoadSettings=function(n,i){u(n,i);t.ChartTitle(n.ChartTitle);t.HorizontalAxis(n.HorizontalAxis);t.HorizontalAxisLabel(n.HorizontalAxisLabel);t.VerticalAxisLabel(n.VerticalAxisLabel);t.DataSeriesColumnIndexes(n.DataSeriesColumnIndexes);t.Values1(n.Values1)},t.RemoveAll=function(){t.DataSeriesColumnIndexes.removeAll()},t.AddAll=function(){t.DataSeriesColumnIndexes.removeAll();$.each(t.AllInputColumnInfos(),function(n,i){t.DataSeriesColumnIndexes.push(i.Index)})},t.RemoveItem=function(n,i){t.DataSeriesColumnIndexes.splice($(i.target).parent().prevAll().length,1)},t.GetColumnName=function(n){return t.AllInputColumns().length>n?t.AllInputColumns()[n]:""},f=t.OnInputsUpdated,t.OnInputsUpdated=function(n){if(f(n),t.DataSeriesColumnIndexes().length==0&&t.Values1()!=null&&t.Inputs().length>0){var i=n.GetNodeById(t.Inputs()[0]);$.each(i.Columns(),function(n,i){i==t.Values1()&&t.DataSeriesColumnIndexes([n])})}},t};nodes.LineChart=function(n){var t=new nodes.Graph(n);return t.RenderResults=function(n){$(n).hasClass("chart")===!1&&$(n).addClass("chart");$(n).hasClass("linechart")===!1&&$(n).addClass("linechart");$(n).empty();t.Inputs().length>0&&t.HorizontalAxis()!=null&&t.DataSeriesColumnIndexes().length>0&&backend.LoadData(models.ServerQueryKey,models.GetCoreNodeSettings(),models.SelectedNode().Id,null,null,"JSON",null,function(i){var r={top:20,right:20,bottom:40,left:50},s=$(n).innerWidth()-r.left-r.right,h=$(n).innerHeight()-r.top-r.bottom,u,l,f,v,e,y,o,w;tools.IsDatetimeType(i.columnTypes[0])?(f=function(n){return new Date(n[0])},u=d3.time.scale().domain(d3.extent(i.rows,f)).range([0,s]),l=d3.svg.axis().scale(u).orient("bottom").ticks(5)):(f=function(n){return n[0]},u=d3.scale.linear().domain(d3.extent(i.rows,f)).range([0,s]),l=d3.svg.axis().scale(u).orient("bottom").ticks(5));var b=Math.min.apply(null,i.rows.map(function(n){return Math.min.apply(null,n.slice(1))})),k=Math.max.apply(null,i.rows.map(function(n){return Math.max.apply(null,n.slice(1))})),p=d3.scale.linear().domain([b,k]).range([h,0]),d=d3.svg.axis().scale(p).orient("left").ticks(5),g=$(n).empty(),nt=d3.select("#"+g.attr("id")).append("svg").attr("width",s+r.left+r.right).attr("height",h+r.top+r.bottom),a=nt.append("g").attr("transform","translate("+r.left+","+r.top+")"),c=a.append("g").attr("transform","translate(0,"+h+")");for(c.call(l),c.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges"),c.selectAll("text").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px"),v=t.HorizontalAxisLabel(),v&&c.append("text").attr("class","label").attr("text-anchor","middle").attr("x",s/2).attr("y",r.bottom-6).text(v),e=a.append("g"),e.call(d),e.selectAll("text").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px"),e.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges"),y=t.VerticalAxisLabel(),y&&e.append("text").attr("transform","rotate(-90)").attr("x",-(h/2)).attr("y",-(r.left-6)).attr("dy",".71em").style("text-anchor","middle").text(y),o=1;o<i.columns.length;o++)w=d3.svg.line().x(function(n){return u(f(n))}).y(function(n){return p(n[o])}),a.append("path").datum(i.rows).attr("fill","none").attr("d",w).attr("stroke",t.Tool.GetSeriesColor(o,1)).attr("stroke-width","1px")})},t};nodes.BarChart=function(n){var t=new nodes.Graph(n);return t.RenderResults=function(n){$(n).hasClass("chart")===!1&&$(n).addClass("chart");$(n).hasClass("barchart")===!1&&$(n).addClass("barchart");t.Inputs().length>0&&t.HorizontalAxis()!=null&&t.DataSeriesColumnIndexes().length>0?backend.LoadData(models.ServerQueryKey,models.GetCoreNodeSettings(),models.SelectedNode().Id,null,null,"JSON",null,function(i){var u={top:20,right:20,bottom:40,left:50},l=$(n).innerWidth()-u.left-u.right,s=$(n).innerHeight()-u.top-u.bottom,it=function(n){return n[0]},f=i.rows.slice(0,25),g=d3.scale.ordinal().domain(f.map(it)).rangeRoundPoints([0,l],1),rt=d3.svg.axis().scale(g).orient("bottom").ticks(f.length),ut=Math.max.apply(null,f.map(function(n){return Math.max.apply(null,n.slice(1))})),a=d3.scale.linear().domain([0,ut]).range([s,0]),ft=d3.svg.axis().scale(a).orient("left").ticks(5),et=$(n).empty(),nt=d3.select("#"+et.attr("id")).append("svg").attr("width",l+u.left+u.right).attr("height",s+u.top+u.bottom),v=nt.append("g").attr("transform","translate("+u.left+","+u.top+")"),h=v.append("g").attr("transform","translate(0,"+s+")"),y,c,p,w,e,o,b,r;if(h.call(rt),h.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges"),h.selectAll(".domain").attr("stroke","none"),h.selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform","rotate(-65)").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px"),y=t.HorizontalAxisLabel(),y&&h.append("text").attr("class","label").attr("text-anchor","middle").attr("x",l/2).attr("y",u.bottom-6).text(y),c=v.append("g"),c.call(ft),c.selectAll("text").attr("font-family","sans-serif").attr("text-anchor","end").attr("font-size","11px"),c.selectAll("line,path").attr("fill","none").attr("stroke","#333333").attr("shape-rendering","crispEdges"),p=t.VerticalAxisLabel(),p&&c.append("text").attr("transform","rotate(-90)").attr("x",-(s/2)).attr("y",-(u.left-6)).attr("dy",".71em").style("text-anchor","middle").text(p),w=0,e=l/f.length,f.length>1){for(o=g.range(),e=o[1]-o[0],r=1;r+1<f.length;r++)b=o[r+1]-o[r],b<e&&(e=b);w=o[0]-e/2}var tt=v.append("g").selectAll("g").data(f).enter().append("g").attr("transform",function(n,t){return"translate("+(w+t*e)+",0)"}),k=6,d=(e-2*k)/(i.columns.length-1);for(r=1;r<i.columns.length;r++)tt.append("rect").attr("x",k+(r-1)*d).attr("y",function(n){return a(n[r])}).attr("height",function(n){return s-a(n[r])}).attr("width",d-1).on("mouseover",function(){d3.select(this.parentNode).selectAll("rect").attr("opacity",.8);d3.select(this.parentNode).selectAll("text").attr("fill","black")}).on("mouseout",function(){d3.select(this.parentNode).selectAll("rect").attr("opacity",1);d3.select(this.parentNode).selectAll("text").attr("fill","none")}).attr("fill",t.Tool.GetSeriesColor(r,1)),tt.append("text").attr("text-anchor","middle").attr("fill","none").attr("x",k+(r-.5)*d).attr("y",function(n){return a(n[r])-3}).text(function(n){return n[r]});nt.attr("height",$("svg > g").get(0).getBBox().height+6);$(".bar").css("background-color","Red")}):$(n).empty()},t};nodes.PieChart=function(n){var t=new nodes.Graph(n),i,r;return t.MinPercentage=ko.observable(1),t.LabelType=ko.observable(),t.LabelTypes=["Name Only","Name and Value","Name and Percentage"],t.Colours=["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c","#ff8c00","#7283a2"],t.OtherColour="#BBB",i=t.GetSaveSettings,t.GetSaveSettings=function(){var n=i();return n.LabelType=t.LabelType(),n.MinPercentage=t.MinPercentage(),n},r=t.LoadSettings,t.LoadSettings=function(n,i){r(n,i);t.LabelType(n.LabelType);t.MinPercentage(n.MinPercentage)},t.AllNumericInputColumnInfos=ko.pureComputed(function(){return t.AllInputColumnInfos().filter(function(n){return tools.IsNumericType(n.Type)})}),t.DataSeriesColumnIndexes.push(null),t.VerticalAxis=ko.pureComputed({read:function(){return t.DataSeriesColumnIndexes()[0]},write:function(n){t.DataSeriesColumnIndexes()[0]=n},owner:t}),t.RenderResults=function(n){$(n).hasClass("chart")===!1&&$(n).addClass("chart");$(n).hasClass("piechart")===!1&&$(n).addClass("piechart");t.Inputs().length>0&&t.HorizontalAxis()!=null&&t.DataSeriesColumnIndexes().length>0?backend.LoadData(models.ServerQueryKey,models.GetCoreNodeSettings(),models.SelectedNode().Id,null,null,"JSON",null,function(i){var r={top:20,right:20,bottom:20,left:50},s=$(n).innerWidth()-r.left-r.right,h=$(n).innerHeight()-r.top-r.bottom,u=Math.min(s,h)/2,c=i.rows.slice(0,25).sort(function(n,t){return t[1]-n[1]}),f=c.reduce(function(n,t){return n+t[1]},0),e=0,o=[];$.each(c,function(n,i){f!=0?(i[2]=100*i[1]/f,i[2]>=t.MinPercentage()?(i[3]=!1,o.push(i)):e+=i[1]):(i[2]=null,i[3]=!1,o.push(i))});e>0&&o.push(["Other",e,f!=0?e/f:null,!0]);var a=d3.layout.pie().sort(null).startAngle(-.25*Math.PI).endAngle(1.75*Math.PI).value(function(n){return n[1]}),l=d3.svg.arc().outerRadius(u*.8).innerRadius(u*.4),v=d3.svg.arc().outerRadius(u*.9).innerRadius(u*.9),y=$(n).empty(),p=d3.select("#"+y.attr("id")).append("svg").attr("width",s+r.left+r.right).attr("height",h+r.top+r.bottom),w=p.append("g").attr("transform","translate("+(r.left+s/2)+","+(r.top+h/2)+")"),b=d3.svg.line().x(function(n){return n[0]}).y(function(n){return n[1]}).interpolate("linear"),k=function(n){var i=n.data[0];return t.LabelType()=="Name and Value"?i+=" ("+n.data[1]+")":t.LabelType()=="Name and Percentage"&&(i+=n.data[2]!=null?" ("+parseFloat(n.data[2].toPrecision(3))+"%)":" ("+n.data[1]+")"),i};$.each(a(o),function(n,i){var r=w.append("g"),s=l.centroid(i),f=v.centroid(i),o=f[0]<0,e=[o?-u:u,f[1]],h=r.append("path").attr("fill",i.data[3]?t.OtherColour:t.Colours[n%t.Colours.length]).attr("d",l(i)),c=r.append("path").attr("d",b([s,f,e])).attr("stroke","black").attr("stroke-width",1).attr("fill","none"),a=r.append("text").text(k(i)).attr("x",e[0]).attr("y",e[1]).attr("text-anchor",o?"end":"start").attr("alignment-baseline","middle")})}):$(n).empty()},t};tools={TemplatesFolder:"/partials/"};tools.ToolBase=function(n){var t={};return t.Name=n.Name,t.Visible=n.Visible,t.Title=n.Title,t.Description=n.Description,t.SymbolPath=n.SymbolPath,t.CreatedCount=0,t.OpenOptionsOnDrop=!1,t.AllowConnectOnDrop=!0,t.MaxInputs=0,t.AllowImageExport=!1,t.HelpUrl=null,t.createNode=function(t,i,r,u){return this.CreatedCount+=1,new n.NodeType({Name:t,Top:i,Left:r,SymbolPath:n.SymbolPath,OptionsTemplateUrl:n.OptionsTemplateUrl,Tool:this,Id:u})},t.Colors=[[100,100,255],[255,100,100],[100,255,100],[100,255,255],[255,255,100],[255,100,255]],t.GetSeriesColor=function(n,i){var r=t.Colors[n%t.Colors.length].slice(0),f=100/Math.floor(n/t.Colors.length),u;if(n>=t.Colors.length)for(u=0;u<r.length;u++)r[u]-=f;return"rgba("+r[0]+","+r[1]+","+r[2]+","+i+")"},t};tools.DatabaseTable=function(){var n=new tools.ToolBase({Name:"Data Table",Title:"Data Table",Visible:!0,Description:"Loads a database table",SymbolPath:"M15.499,23.438c-3.846,0-7.708-0.987-9.534-3.117c-0.054,0.236-0.09,0.48-0.09,0.737v3.877c0,3.435,4.988,4.998,9.625,4.998s9.625-1.563,9.625-4.998v-3.877c0-0.258-0.036-0.501-0.09-0.737C23.209,22.451,19.347,23.438,15.499,23.438zM15.499,15.943c-3.846,0-7.708-0.987-9.533-3.117c-0.054,0.236-0.091,0.479-0.091,0.736v3.877c0,3.435,4.988,4.998,9.625,4.998s9.625-1.563,9.625-4.998v-3.877c0-0.257-0.036-0.501-0.09-0.737C23.209,14.956,19.347,15.943,15.499,15.943zM15.5,1.066c-4.637,0-9.625,1.565-9.625,5.001v3.876c0,3.435,4.988,4.998,9.625,4.998s9.625-1.563,9.625-4.998V6.067C25.125,2.632,20.137,1.066,15.5,1.066zM15.5,9.066c-4.211,0-7.625-1.343-7.625-3c0-1.656,3.414-3,7.625-3s7.625,1.344,7.625,3C23.125,7.724,19.711,9.066,15.5,9.066z",NodeType:nodes.DatabaseTable,OptionsTemplateUrl:tools.TemplatesFolder+"DatabaseTable.html"});return n.OpenOptionsOnDrop=!0,n.HelpUrl="http://querytreeapp.com/help/tools/data-table/",n};tools.Join=function(){var n=new tools.ToolBase({Name:"Join",Title:"Join",Visible:!0,Description:"Link two tables together where two column values are the same",SymbolPath:"M29.342,15.5L21.785999999999998,11.137V13.75H20.374999999999996C19.586999999999996,13.74,19.043999999999997,13.509,18.355999999999995,13.007C17.334999999999994,12.262,16.261999999999993,10.826,14.804999999999994,9.439C13.367,8.06,11.291,6.73,8.5,6.749H2.812V10.248999999999999H8.5C10.731,10.261,11.940999999999999,11.434,13.57,13.183C14.267,13.936,14.998000000000001,14.763,15.894,15.506C14.498000000000001,16.671,13.482,18.022,12.41,19.007C11.227,20.088,10.208,20.73,8.498000000000001,20.748H2.813V24.248H8.529C12.280999999999999,24.249000000000002,14.564,21.929000000000002,16.148,20.182000000000002C16.965,19.287000000000003,17.685,18.491000000000003,18.357,17.991000000000003C19.043,17.489000000000004,19.587,17.259000000000004,20.374,17.249000000000002H21.785999999999998V19.863000000000003L29.342,15.5Z",NodeType:nodes.Join,OptionsTemplateUrl:tools.TemplatesFolder+"Join.html"});return n.JoinType=ko.observableArray([{id:"Inner",text:"Only matches from both"},{id:"LeftOuter",text:"All of Table 1, with matches from Table 2"},{id:"RightOuter",text:"All of Table 2, with matches from Table 1"},{id:"FullOuter",text:"All of both tables, matched where possible"},{id:"Cross",text:"Every possible combination"}]),n.MaxInputs=2,n.HelpUrl="http://querytreeapp.com/help/tools/join/",n};tools.Filter=function(){var n=new tools.ToolBase({Name:"Filter",Title:"Filter",Visible:!0,Description:"Remove rows from a table that don't meet certain criteria",SymbolPath:"M29.772,26.433L22.645999999999997,19.307C23.605999999999998,17.724,24.168999999999997,15.871999999999998,24.169999999999998,13.886C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885C3.204,19.674,7.897,24.366,13.688,24.366C15.675,24.366,17.527,23.803,19.11,22.843L26.238,29.97L29.772,26.433ZM7.203,13.885C7.2090000000000005,10.303,10.106,7.407,13.687000000000001,7.399C17.266000000000002,7.407,20.165,10.303,20.171,13.885C20.163999999999998,17.465,17.266,20.361,13.687,20.369C10.106,20.361,7.209,17.465,7.203,13.885Z",NodeType:nodes.Filter,OptionsTemplateUrl:tools.TemplatesFolder+"Filter.html"});return n.Operators=ko.observableArray([{type:"EqualTo",simpleName:"is equal to",number:!0,text:!0,date:!0,bool:!0,compareValue:!0,showCaseSensitive:!0},{type:"DoesNotEqual",simpleName:"is not equal to",number:!0,text:!0,date:!0,bool:!0,compareValue:!0,showCaseSensitive:!0},{type:"GreaterThan",simpleName:"is greater than",number:!0,text:!0,date:!0,bool:!1,compareValue:!0,showCaseSensitive:!1},{type:"GreaterThanOrEqualTo",simpleName:"is greater than or equal to",number:!0,text:!0,date:!0,bool:!1,compareValue:!0,showCaseSensitive:!1},{type:"LessThan",simpleName:"is less than",number:!0,text:!0,date:!0,bool:!1,compareValue:!0,showCaseSensitive:!1},{type:"LessThanOrEqualTo",simpleName:"is less than or equal to",number:!0,text:!0,date:!0,bool:!1,compareValue:!0,showCaseSensitive:!1},{type:"StartsWith",simpleName:"starts with",number:!1,text:!0,date:!1,bool:!1,compareValue:!0,showCaseSensitive:!0},{type:"EndsWith",simpleName:"ends with",number:!1,text:!0,date:!1,bool:!1,compareValue:!0,showCaseSensitive:!0},{type:"Contains",simpleName:"contains",number:!1,text:!0,date:!1,bool:!1,compareValue:!0,showCaseSensitive:!0},{type:"DoesNotContain",simpleName:"doesn't contain",number:!1,text:!0,date:!1,bool:!1,compareValue:!0,showCaseSensitive:!0},{type:"IsEmpty",simpleName:"is empty",number:!0,text:!0,date:!0,bool:!0,compareValue:!1,showCaseSensitive:!1},{type:"IsNotEmpty",simpleName:"is not empty",number:!0,text:!0,date:!0,bool:!0,compareValue:!1,showCaseSensitive:!1},{type:"Last24Hours",simpleName:"was in the last 24 hours",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"Next24Hours",simpleName:"is in the next 24 hours",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"Last7Days",simpleName:"was in the last 7 days",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"Next7Days",simpleName:"is in the next 7 days",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"ThisMonth",simpleName:"is this month",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"NextMonth",simpleName:"is next month",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"LastMonth",simpleName:"was last month",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"Last90Days",simpleName:"was in the last 90 days",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"Next90Days",simpleName:"is in the next 90 days",number:!1,text:!1,date:!0,bool:!1,compareValue:!1,showCaseSensitive:!1},{type:"LastNDays",simpleName:"was in the last N days",number:!1,text:!1,date:!0,bool:!1,compareValue:!0,showCaseSensitive:!1,compareValueType:"numeric"},{type:"NextNDays",simpleName:"is in the next N days",number:!1,text:!1,date:!0,bool:!1,compareValue:!0,showCaseSensitive:!1,compareValueType:"numeric"}]),n.MaxInputs=1,n.HelpUrl="http://querytreeapp.com/help/tools/filter/",n};tools.Sort=function(){var n=new tools.ToolBase({Name:"Sort",Title:"Sort",Visible:!0,Description:"Sort the rows into ascending or descending order of values",SymbolPath:"M21.786,20.654C21.168000000000003,20.459,20.379,19.951,19.495,19.067C18.738,18.325,17.956,17.369,17.155,16.326C16.964000000000002,16.582,16.773,16.836000000000002,16.581,17.096C16.057,17.805,15.522,18.52,14.977,19.223C16.881,21.532999999999998,18.857,23.801,21.786,24.174999999999997V26.875999999999998L29.342000000000002,22.513999999999996L21.786,18.151999999999994V20.654ZM9.192,11.933C9.948,12.674,10.73,13.629999999999999,11.531,14.672C11.726,14.41,11.921000000000001,14.151,12.118,13.884C12.638,13.181000000000001,13.169,12.472000000000001,13.71,11.774000000000001C11.678,9.311,9.577000000000002,6.867000000000001,6.314000000000001,6.7490000000000006H2.814000000000001V10.249H6.314000000000001C6.969,10.223,7.996,10.735,9.192,11.933ZM21.786,10.341V12.876L29.342000000000002,8.512999999999998L21.786,4.149999999999998V6.796999999999997C19.882,7.015999999999997,18.361,8.144999999999998,17.035,9.440999999999997C14.839,11.623999999999997,12.919,14.607999999999997,11.024000000000001,16.979C9.157,19.416999999999998,7.283000000000001,20.866999999999997,6.312000000000001,20.75H2.812000000000001V24.25H6.312000000000001C8.497000000000002,24.221,10.191,22.984,11.652000000000001,21.557C13.846,19.372999999999998,15.768,16.39,17.661,14.018999999999998C19.205,12.003,20.746,10.679,21.786,10.341Z",NodeType:nodes.Sort,OptionsTemplateUrl:tools.TemplatesFolder+"Sort.html"});return n.MaxInputs=1,n.HelpUrl="http://querytreeapp.com/help/tools/sort/",n};tools.Select=function(){var n=new tools.ToolBase({Name:"Select",Title:"Select",Visible:!0,Description:"Pick which columns you want and in what order they should appear",SymbolPath:"M29.548,3.043c-1.081-0.859-2.651-0.679-3.513,0.401L16,16.066l-3.508-4.414c-0.859-1.081-2.431-1.26-3.513-0.401c-1.081,0.859-1.261,2.432-0.401,3.513l5.465,6.875c0.474,0.598,1.195,0.944,1.957,0.944c0.762,0,1.482-0.349,1.957-0.944L29.949,6.556C30.809,5.475,30.629,3.902,29.548,3.043zM24.5,24.5h-17v-17h12.756l2.385-3H6C5.171,4.5,4.5,5.171,4.5,6v20c0,0.828,0.671,1.5,1.5,1.5h20c0.828,0,1.5-0.672,1.5-1.5V12.851l-3,3.773V24.5z",NodeType:nodes.Select,OptionsTemplateUrl:tools.TemplatesFolder+"Select.html"});return n.MaxInputs=1,n.HelpUrl="http://querytreeapp.com/help/tools/select/",n};tools.Append=function(){var n=new tools.ToolBase({Name:"Append",Title:"Append",Visible:!0,Description:"Create a table from the child values on each row of the source table",SymbolPath:"M26.679,7.858c-0.176-0.138-0.404-0.17-0.606-0.083l-9.66,4.183c-0.42,0.183-0.946,0.271-1.486,0.271c-0.753,0.002-1.532-0.173-2.075-0.412c-0.194-0.083-0.356-0.176-0.471-0.259c0.042-0.021,0.09-0.042,0.146-0.064l8.786-3.804l1.31,0.561V6.612c0-0.244-0.106-0.475-0.283-0.612c-0.176-0.138-0.406-0.17-0.605-0.083l-9.66,4.183c-0.298,0.121-0.554,0.268-0.771,0.483c-0.213,0.208-0.397,0.552-0.394,0.934c0,0.01,0.003,0.027,0.003,0.027v14.73c0,0.006-0.002,0.012-0.002,0.019c0,0.005,0.002,0.007,0.002,0.012v0.015h0.002c0.021,0.515,0.28,0.843,0.528,1.075c0.781,0.688,2.091,1.073,3.484,1.093c0.66,0,1.33-0.1,1.951-0.366l9.662-4.184c0.255-0.109,0.422-0.383,0.422-0.692V8.471C26.961,8.227,26.855,7.996,26.679,7.858zM20.553,5.058c-0.017-0.221-0.108-0.429-0.271-0.556c-0.176-0.138-0.404-0.17-0.606-0.083l-9.66,4.183C9.596,8.784,9.069,8.873,8.53,8.873C7.777,8.874,6.998,8.699,6.455,8.46C6.262,8.378,6.099,8.285,5.984,8.202C6.026,8.181,6.075,8.16,6.13,8.138l8.787-3.804l1.309,0.561V3.256c0-0.244-0.106-0.475-0.283-0.612c-0.176-0.138-0.407-0.17-0.606-0.083l-9.66,4.183C5.379,6.864,5.124,7.011,4.907,7.227C4.693,7.435,4.51,7.779,4.513,8.161c0,0.011,0.003,0.027,0.003,0.027v14.73c0,0.006-0.001,0.013-0.001,0.019c0,0.005,0.001,0.007,0.001,0.012v0.016h0.002c0.021,0.515,0.28,0.843,0.528,1.075c0.781,0.688,2.091,1.072,3.485,1.092c0.376,0,0.754-0.045,1.126-0.122V11.544c-0.01-0.7,0.27-1.372,0.762-1.856c0.319-0.315,0.708-0.564,1.19-0.756L20.553,5.058z",NodeType:nodes.Append,OptionsTemplateUrl:tools.TemplatesFolder+"Append.html"});return n.MaxInputs=9999,n.HelpUrl="http://querytreeapp.com/help/tools/append/",n};tools.LineChart=function(){var n=new tools.ToolBase({Name:"Line Chart",Title:"Line Chart",Visible:!0,Description:"Draw a line chart with lines coming from one or more columns on the source table",SymbolPath:"M3.625,25.062C3.086,24.947000000000003,2.74,24.416,2.855,23.875L2.855,23.875L6.51,6.584L8.777,15.843L10.7,10.655000000000001L14.280999999999999,14.396L18.163999999999998,1.293000000000001L21.098,13.027000000000001L23.058,11.518L28.329,23.258000000000003C28.555,23.762000000000004,28.329,24.353,27.824,24.579000000000004L27.824,24.579000000000004C27.319000000000003,24.806000000000004,26.728,24.579000000000004,26.502000000000002,24.075000000000003L26.502000000000002,24.075000000000003L22.272000000000002,14.647000000000002L19.898000000000003,16.473000000000003L18.002000000000002,8.877000000000002L15.219000000000003,18.270000000000003L11.465000000000003,14.346000000000004L8.386,22.66L6.654999999999999,15.577L4.811999999999999,24.288C4.710999999999999,24.76,4.297,25.082,3.8329999999999993,25.082L3.8329999999999993,25.082C3.765,25.083,3.695,25.076,3.625,25.062L3.625,25.062Z",NodeType:nodes.LineChart,OptionsTemplateUrl:tools.TemplatesFolder+"LineChart.html"});return n.MaxInputs=1,n.AllowImageExport=!0,n.HelpUrl="http://querytreeapp.com/help/tools/line-chart/",n};tools.BarChart=function(){var n=new tools.ToolBase({Name:"Bar Chart",Title:"Bar Chart",Visible:!0,Description:"Draw a bar chart with the the size of the bars coming from one or more columns on the source table",SymbolPath:"M21.25,8.375V28H27.75V8.375H21.25ZM12.25,28H18.75V4.125H12.25V28ZM3.25,28H9.75V12.625H3.25V28Z",NodeType:nodes.BarChart,OptionsTemplateUrl:tools.TemplatesFolder+"BarChart.html"});return n.MaxInputs=1,n.AllowImageExport=!0,n.HelpUrl="http://querytreeapp.com/help/tools/bar-chart/",n};tools.PieChart=function(){var n=new tools.ToolBase({Name:"Pie Chart",Title:"Pie Chart",Visible:!0,Description:"Draw a pie chart with the the size of the segments coming from one of columns on the source table",SymbolPath:"M17.203,10.187c0.959,0.194,1.862,0.652,2.62,1.358l6.851-5.207c-0.063-0.073-0.116-0.151-0.182-0.222c-2.5-2.758-5.845-4.275-9.283-4.543L17.203,10.187zM29.744,18.748c0.867-3.688,0.219-7.666-1.97-10.958l-6.838,5.198c0.514,0.974,0.708,2.057,0.597,3.119L29.744,18.748zM21.057,17.867c-0.297,0.629-0.717,1.215-1.266,1.712c-2.236,2.028-5.692,1.86-7.719-0.378c-2.027-2.237-1.86-5.695,0.377-7.723c0.85-0.771,1.876-1.222,2.933-1.365l0.005-8.575c-3.111,0.162-6.188,1.354-8.676,3.612c-5.728,5.198-6.16,14.06-0.964,19.792c5.195,5.729,14.052,6.164,19.781,0.964c1.699-1.543,2.92-3.409,3.679-5.418L21.057,17.867z",NodeType:nodes.PieChart,OptionsTemplateUrl:tools.TemplatesFolder+"PieChart.html"});return n.MaxInputs=1,n.AllowImageExport=!0,n.HelpUrl="http://querytreeapp.com/help/tools/pie-chart/",n};tools.Summarize=function(){var n=new tools.ToolBase({Name:"Summarize",Title:"Summarize",Visible:!0,Description:"Displays the statistics for the connected source table2",SymbolPath:"M22.646,19.307c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127l3.535-3.537L22.646,19.307zM13.688,20.369c-3.582-0.008-6.478-2.904-6.484-6.484c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486C20.165,17.465,17.267,20.361,13.688,20.369zM15.687,9.051h-4v2.833H8.854v4.001h2.833v2.833h4v-2.834h2.832v-3.999h-2.833V9.051z",NodeType:nodes.Summarize,OptionsTemplateUrl:tools.TemplatesFolder+"Summarize.html"});return n.AggFunctions=ko.observableArray([{id:1,text:"Number of Rows",requiresColumn:!1,WorksWithDates:!0},{id:2,text:"Total",requiresColumn:!0,WorksWithDates:!1},{id:3,text:"Minimum",requiresColumn:!0,WorksWithDates:!0},{id:4,text:"Maximum",requiresColumn:!0,WorksWithDates:!0},{id:5,text:"Average",requiresColumn:!0,WorksWithDates:!1},{id:6,text:"Median",requiresColumn:!0,WorksWithDates:!1}]),n.DateFunctions=ko.observableArray([{id:1,text:"Date"},{id:2,text:"Month"},{id:3,text:"Year"},]),n.MaxInputs=1,n.HelpUrl="http://querytreeapp.com/help/tools/statistics/",n};tools.Extract=function(){var n=new tools.ToolBase({Name:"Extract",Title:"Extract",Visible:!0,Description:"Makes a new column by extracting text from within another column",SymbolPath:"M14.505,5.873c-3.937,2.52-5.904,5.556-5.904,9.108c0,1.104,0.192,1.656,0.576,1.656l0.396-0.107c0.312-0.12,0.563-0.18,0.756-0.18c1.128,0,2.07,0.411,2.826,1.229c0.756,0.82,1.134,1.832,1.134,3.037c0,1.157-0.408,2.14-1.224,2.947c-0.816,0.807-1.801,1.211-2.952,1.211c-1.608,0-2.935-0.661-3.979-1.984c-1.044-1.321-1.565-2.98-1.565-4.977c0-2.259,0.443-4.327,1.332-6.203c0.888-1.875,2.243-3.57,4.067-5.085c1.824-1.514,2.988-2.272,3.492-2.272c0.336,0,0.612,0.162,0.828,0.486c0.216,0.324,0.324,0.606,0.324,0.846L14.505,5.873zM27.465,5.873c-3.937,2.52-5.904,5.556-5.904,9.108c0,1.104,0.192,1.656,0.576,1.656l0.396-0.107c0.312-0.12,0.563-0.18,0.756-0.18c1.104,0,2.04,0.411,2.808,1.229c0.769,0.82,1.152,1.832,1.152,3.037c0,1.157-0.408,2.14-1.224,2.947c-0.816,0.807-1.801,1.211-2.952,1.211c-1.608,0-2.935-0.661-3.979-1.984c-1.044-1.321-1.565-2.98-1.565-4.977c0-2.284,0.449-4.369,1.35-6.256c0.9-1.887,2.256-3.577,4.068-5.067c1.812-1.49,2.97-2.236,3.474-2.236c0.336,0,0.612,0.162,0.828,0.486c0.216,0.324,0.324,0.606,0.324,0.846L27.465,5.873z",NodeType:nodes.Extract,OptionsTemplateUrl:tools.TemplatesFolder+"Extract.html"});return n.MaxInputs=1,n.StartTypes=ko.observableArray([{id:1,text:"The beginning"},{id:2,text:"At a specific position"},{id:3,text:"At the first occurrence of..."},{id:4,text:"After the first occurrence of..."},]),n.EndTypes=ko.observableArray([{id:1,text:"The end"},{id:2,text:"At a specific position"},{id:3,text:"At a specific length"},{id:4,text:"At the next occurrence of..."},{id:5,text:"After the next occurrence of..."},]),n.HelpUrl="http://querytreeapp.com/help/tools/extract/",n};tools.IsNumericType=function(n){switch(n.toUpperCase()){case"INTEGER":case"INT":case"SMALLINT":case"TINYINT":case"MEDIUMINT":case"BIGINT":case"DECIMAL":case"NUMERIC":case"FLOAT":case"DOUBLE":case"REAL":case"MONEY":case"SMALLMONEY":case"DOUBLE PRECISION":case"SMALLSERIAL":case"SERIAL":case"BIGSERIAL":case"INT4":case"INT8":return!0;default:return!1}};tools.IsDatetimeType=function(n){switch(n.toUpperCase()){case"DATE":case"DATETIME":case"DATETIME2":case"SMALLDATETIME":case"TIME":case"TIMESTAMP":case"TIMESTAMP WITHOUT TIME ZONE":case"TIMESTAMP WITH TIME ZONE":case"TIME WITHOUT TIME ZONE":case"TIME WITH TIME ZONE":case"INTERVAL":return!0;default:return!1}};tools.IsTextType=function(n){switch(n.toUpperCase()){case"VARCHAR":case"NVARCHAR":case"CHAR":case"NCHAR":case"TEXT":case"NTEXT":case"XML":case"UNIQUEIDENTIFIER":case"BINARY":case"VARBINARY":case"IMAGE":case"ENUM":case"CHARACTER VARYING":case"CHARACTER":case"TEXT":case"LONGTEXT":case"USER-DEFINED":return!0;default:return!1}};models={ResultsOnly:ko.observable(!1),ResultsOnlyLoaded:ko.observable(!1),ServerQueryKey:ko.observable(),ui_state:{workspace_canvas:null,dragging_handle:null,connecting_handle:null,connector:{IsVisible:ko.observable(!1),StartX:ko.observable(),StartY:ko.observable(),EndX:ko.observable(),EndY:ko.observable()}},SelectedNode:ko.observable(),SelectedConnector:ko.observable(),SuggestedConnection:{IsVisible:ko.observable(!1),FromNodeId:ko.observable(null),ToNodeId:ko.observable(null),ToDroppingPoint:{X:ko.observable(0),Y:ko.observable(0)}},Tools:[new tools.DatabaseTable,new tools.Sort,new tools.Filter,new tools.Join,new tools.Summarize,new tools.Select,new tools.Append,new tools.Extract,new tools.LineChart,new tools.BarChart,new tools.PieChart]};models.SelectedNodeHasRender=ko.computed(function(){return models.SelectedNode()!=null?models.SelectedNode().RenderResults?!0:!1:!1});models.SelectedNodeHasRenderAndNotError=ko.computed(function(){return models.SelectedNode()!=null?models.SelectedNodeHasRender()&&!models.SelectedNodeHasError()?!0:!1:!1});formatNumber=function(n){nStr=n+"";x=nStr.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";for(var t=/(\d+)(\d{3})/;t.test(x1);)x1=x1.replace(t,"$1,$2");return x1+x2};models.CurrentData=ko.observableArray();models.CurrentRowStart=ko.observable(0);models.CurrentRowStartFormatted=ko.computed(function(){return formatNumber(models.CurrentRowStart())});models.CurrentRowEnd=ko.observable(null);models.CurrentRowEndFormatted=ko.computed(function(){return formatNumber(models.CurrentRowEnd())});models.CurrentRowsTotal=ko.observable();models.CurrentRowsTotalFormatted=ko.computed(function(){return formatNumber(models.CurrentRowsTotal())});models.DataPageSize=ko.observable(10);models.CurrentDataColumns=ko.observableArray();models.IsPreviousVisible=ko.computed(function(){return models.CurrentRowStart()!=null?models.CurrentRowStart()>1:!1});models.IsNextVisible=ko.computed(function(){return models.CurrentRowEnd()!=null?models.CurrentRowEnd()<models.CurrentRowsTotal():!1});models.IsDataVisible=ko.computed(function(){return models.SelectedNode()!=null&&models.CurrentData()!=null&&models.CurrentData().length>0&&models.SelectedNodeStatus()=="ok"&&models.RenderResults==undefined?!0:!1});models.SelectedNodeStatus=ko.observable(null);models.SelectedNodeHasError=ko.computed(function(){return models.SelectedNodeStatus()!=null&&models.SelectedNodeStatus()!="ok"});models.SelectedNodeErrorText=ko.computed(function(){return models.SelectedNode()!=null?models.SelectedNode().ErrorText():null});models.ObjectSelected=ko.computed(function(){return models.SelectedNode()!=null});models.ShowOptions=ko.computed(function(){return models.SelectedNode()!=null});models.ShowExportImage=ko.computed(function(){return models.SelectedNode()!=null&&models.SelectedNode().Tool.AllowImageExport});models.ShowExport=ko.computed(function(){return models.IsDataVisible()||models.ShowExportImage()});buildNodesArgs=function(n){var t=[];return $.each(n.current_nodes(),function(n,i){t.push(i.GetCoreSettings())}),t=JSON.stringify(t)};models.ExportFileName=ko.observable();models.ExportUrl=ko.observable();models.Export=function(){var i=models.SelectedNode(),n,t;if(i!=null){if(models.ShowExportImage()){var f=$("div[data-results-node-id='"+i.Id+"']"),r=document.getElementById(f.attr("Id")).children[0],e=new XMLSerializer,u=new Image;return u.src="data:image/svg+xml;base64,"+window.btoa(e.serializeToString(r)),n=document.createElement("canvas"),n.width=$(r).width(),n.height=$(r).height(),ctx=n.getContext("2d"),ctx.fillStyle="#FFFFFF",ctx.fillRect(0,0,n.width,n.height),ctx.drawImage(u,0,0,n.width,n.height),t=n.toDataURL("image/png"),t=t.replace(":image/png;",":application/octet-stream;"),models.ExportUrl(t),models.ExportFileName("image.png"),!0}return models.ServerQueryKey()?(models.ExportUrl(backend.baseUri+"/api/cache/"+models.ServerQueryKey()+"/"+i.Id+"/export/"),models.ExportFileName("export.xlsx")):(models.ExportUrl(null),models.ExportFileName(null)),!0}models.ExportFileName("");models.ExportUrl("")};models.current_nodes=ko.observableArray();models.findTool=function(n){var t=null;return $.each(models.Tools,function(i,r){r.Name===n&&(t=r)}),t};models.GetNodeAt=function(n,t){var i=null;return $.each(models.current_nodes(),function(r,u){u.Top()<=t&&u.Top()+48>=t&&u.Left()<=n&&u.Left()+48>=n&&(i=u)}),i};models.GetNodeDragHandle=function(n,t){var i=models.GetNodeAt(n,t),r=null;return i!=null&&(r={node:i,x:n-i.Left(),y:t-i.Top()}),r};models.GetNodeConnectionHandle=function(n,t,i){var r=null;return $.each(models.current_nodes(),function(u,f){f.Inputs&&i==="output"&&f.Top()<=t&&f.Top()+48>=t&&f.Left()-16<=n&&f.Left()+48>=n&&(r={node:f,type:"input",mouseX:n,mouseY:t});(f.Type==="DataSource"||f.Type==="DataProcessor")&&(i==="input"||i==undefined)&&f.Top()+20<=t&&f.Top()+28>=t&&f.Left()+56<=n&&f.Left()+64>=n&&(r={node:f,type:"output",mouseX:n,mouseY:t})}),r};models.GetControlPoint=function(n,t){return{x:Math.min(n.x,t.x)+Math.abs(n.x-t.x)/2,y:Math.min(n.y,t.y)}};models.GetConnectorAt=function(n,t){var i=null;return $.each(models.current_nodes(),function(r,u){u.Inputs&&$.each(u.Inputs(),function(r,f){for(var e=0;e<=1;e+=.05){var s=u.GetReceiverPoint(),h=models.GetNodeById(f).GetTransmitterPoint(),a=models.GetControlPoint(h,s),v=h.x,y=h.y,c=a.x,l=a.y,b=s.x,k=s.y,p=v+(c-v)*e,w=y+(l-y)*e,d=c+(b-c)*e,g=l+(k-l)*e,nt=p+(d-p)*e,tt=w+(g-w)*e,o={x:nt,y:tt};if(o.x-12<n&&n<o.x+12&&o.y-12<t&&t<o.y+12)return i={fromNodeId:f,toNodeId:u.Id},!1}})}),i};models.RemoveConnector=function(n,t){var i=models.GetNodeById(t),r=i.Inputs.remove(function(t){return t===n});$.each(r,function(n,t){var f,r,e,u;if(i.inputPaths){models.ui_state.workspace_canvas.remove(i.inputPaths[t]);models.ui_state.workspace_canvas.remove(i.inputCircles[t]);f={};for(r in i.inputPaths)r!==t&&(f[r]=i.inputPaths[r]);i.inputPaths=f;e={};for(u in i.inputCircles)u!==t&&(e[u]=i.inputCircles[u]);i.inputCircles=e}});r.length>0&&i.OnInputsUpdated(models)};models.GetNodeById=function(n){var t=null;return $.each(models.current_nodes(),function(i,r){r.Id===n&&(t=r)}),t};models.RemoveNode=function(n){$.each(models.current_nodes(),function(t,i){if(i.Inputs){var r=i.Inputs.remove(function(t){return t===n});$.each(r,function(n,t){i.inputPaths&&(models.ui_state.workspace_canvas.remove(i.inputPaths[t]),models.ui_state.workspace_canvas.remove(i.inputCircles[t]),delete i.inputPaths[t],delete i.inputCircles[t])});r.length>0&&i.OnInputsUpdated(models)}});var t=models.current_nodes.remove(function(t){return t.Id===n});t&&$.each(t,function(n,t){t.iconGroup&&models.ui_state.workspace_canvas.remove(t.iconGroup);t.inputPaths&&($.each(t.inputPaths,function(n,t){models.ui_state.workspace_canvas.remove(t)}),$.each(t.inputCircles,function(n,t){models.ui_state.workspace_canvas.remove(t)}));t===models.SelectedNode()&&models.SelectedNode(null)})};models.IsCircularDependency=function(n,t){var i=function(n,t){var r=!1;return $.each(n,function(n,u){if(u===t)return r=!0,!1;var f=models.GetNodeById(u);if(f&&f.Inputs&&i(f.Inputs(),t))return r=!0,!1}),r};return n.Inputs?i(n.Inputs(),t.Id):!1};models.GetNodeInSuggestionRange=function(n,t,i,r){var u=null;return i==undefined&&(i=!0),$.each(models.current_nodes(),function(f,e){var o,s;r&&e.Id==r||(o=null,i?e.GetTransmitterPoint&&(o=e.GetTransmitterPoint()):e.GetReceiverPoint&&(o=e.GetReceiverPoint()),o!=null&&(s=Math.sqrt(Math.pow(n-o.x,2)+Math.pow(t-o.y,2)),s<80&&(u==null||u.distance>s)&&(u={distance:s,node:e})))}),u?u.node:null};models.SuggestedConnection.FromPoint=ko.computed(function(){var t=models.GetNodeById(models.SuggestedConnection.FromNodeId()),n;return t!=null?(n=t.GetTransmitterPoint(),{X:n.x,Y:n.y}):{X:0,Y:0}});models.SuggestedConnection.ToPoint=ko.computed(function(){var t=models.GetNodeById(models.SuggestedConnection.ToNodeId()),n;return t!=null?(n=t.GetReceiverPoint(),{X:n.x,Y:n.y}):models.SuggestedConnection.ToDroppingPoint.X()!==0&&models.SuggestedConnection.ToDroppingPoint.Y()!==0?{X:models.SuggestedConnection.ToDroppingPoint.X(),Y:models.SuggestedConnection.ToDroppingPoint.Y()}:{X:0,Y:0}});models.RemoveEverything=function(){models.current_nodes.removeAll();models.ui_state.workspace_canvas!=null&&models.ui_state.workspace_canvas.clear();models.SelectedNode(null);models.SelectedConnector(null);$.each(models.Tools,function(n,t){t.CreatedCount=0})};models.MaxNodesWidth=function(){var n=0;return $.each(models.current_nodes(),function(t,i){n=Math.max(n,i.GetRightExtent())}),n};models.MaxNodesHeight=function(){var n=0;return $.each(models.current_nodes(),function(t,i){n=Math.max(n,i.GetBottomExtent())}),n};models.FormatColumn=function(n,t){var i=null;if(models.SelectedNode()!=null&&(i=models.SelectedNode().ColumnTypes()[n]),t!=null)switch(i){case"datetime":return moment(t).format("lll");case"date":return moment(t).format("ll");default:return t}return null};models.GetCoreNodeSettings=function(){var n=[];return $.each(models.current_nodes(),function(t,i){n.push(i.GetCoreSettings())}),n};getMouse=function(n){var t=$("#workspace_canvas").offset();return n.touches&&n.touches.length>0?{x:n.touches[0].pageX-t.left-1,y:n.touches[0].pageY-t.top}:{x:n.pageX-t.left-1,y:n.pageY-t.top}};events={};events.OnBottomPanelResize=function(n,t){events.OnResultsPanelResize(t.offset.top-$("#qt-container").offset().top)};events.SetBottomPanelSize=function(){$("div#bottom_panel").css("height",$(window).height()-($("div#top_panel").height()+$("div#navbar").height())+"px");$("div#bottom_panel").find(".flexibleHeight").css("height",$("div#bottom_panel").height()-12)};events.OnResultsPanelResize=function(n){var i=n,r=$("div#qt-container").height()-n,t;$("div#top_panel").css("height",i+"px");$("div#bottom_panel").css("height",r+"px");t=$("#workspace");models.ui_state.workspace_canvas.setWidth(Math.max(t.width()-15,models.MaxNodesWidth()));models.ui_state.workspace_canvas.setHeight(Math.max(t.height()-3,models.MaxNodesHeight()));models.ui_state.workspace_canvas.calcOffset();$("div#bottom_panel").find(".flexibleHeight").css("height",$("div#bottom_panel").height()-12);models.SelectedNode()&&models.SelectedNode().RenderResults&&models.SelectedNode().RenderResults($("#nonTabularResultsContainer > div[data-results-node-id='"+models.SelectedNode().Id+"']"),models)};events.OnToolDrag=function(n,t,i){var s=t.helper.offset(),f=$("#workspace_canvas").offset(),r={left:s.left-f.left-12,top:s.top-f.top+24},u,e,o;i.AllowConnectOnDrop&&i.MaxInputs>0&&(u=models.GetNodeInSuggestionRange(r.left,r.top),u&&u.GetTransmitterPoint?(models.SuggestedConnection.FromNodeId(u.Id),models.SuggestedConnection.ToNodeId(null),Math.abs(r.top-24-u.Top())<10&&(r.top=u.Top()+24),e=Math.abs(r.left-u.Left()+12),e>110&&e<130&&(r.left=u.Left()+120-12),o={x:r.left,y:r.top},models.SuggestedConnection.ToDroppingPoint.X(o.x),models.SuggestedConnection.ToDroppingPoint.Y(o.y),models.SuggestedConnection.IsVisible(!0)):models.SuggestedConnection.IsVisible(!1));$("#dropTarget").offset({top:r.top+f.top-24,left:r.left+f.left+12})};events.OnToolDrop=function(n,t,i){var u=$("#workspace_canvas").offset(),f=$("#dropTarget").offset(),e=!1,r;i&&(r=i.createNode(i.Title+" "+(i.CreatedCount+1),f.top-u.top,f.left-u.left),models.current_nodes.push(r),models.SuggestedConnection.IsVisible()===!0&&(r.Inputs.push(models.SuggestedConnection.FromNodeId()),r.OnInputsUpdated(models),e=!0),events.LoadNodeOptionsTemplate(r,function(){events.SelectNode(r);(r.Tool.OpenOptionsOnDrop||e)&&events.ShowOptionsDialog()}))};events.LoadNodeOptionsTemplate=function(n,t){$("#node_options_container").append(`
        <div class='modal' data-node-id='`+n.Id+`' role='dialog'>
            <div class='modal-dialog' role='document'>
                <div class='modal-content'>
                    <div class='modal-header'>
                        <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>
                        <h4 class='modal-title'>Tool Options</h4>
                    </div>
                    <div class='modal-body'>
                    </div>
                    <div class="modal-footer">
                        <button type='button' class='btn btn-danger remove'>Remove Tool</button>
                        <button type='button' class='btn btn-primary ok'>OK</button>
                    </div>
                </div>
            </div>
        </div>
    </div>`);$("#node_options_container > div[data-node-id='"+n.Id+"'] div.modal-body").load(n.OptionsTemplateUrl,function(){var i=$("#node_options_container > div[data-node-id='"+n.Id+"'] div.modal-body");ko.applyBindings(n,i[0]);n.Tool.HelpUrl&&i.append("<div class='form-group toolHelpLink'><a href='"+n.Tool.HelpUrl+"' target='_blank'>How does this tool work?<\/a>");$("#node_options_container > div[data-node-id='"+n.Id+"'] button.remove").click(events.ActiveOptionsModalRemove);$("#node_options_container > div[data-node-id='"+n.Id+"'] button.ok").click(events.ActiveOptionsModalOK);t&&t()})};events.OnWindowResize=function(){events.OnResultsPanelResize($("#resize_bar").offset().top-$("#qt-container").offset().top)};snapToNode=function(n,t,i){var u=1,r;i&&(u=-1);Math.abs(t.Top()-n.Top())<10&&t.Top(n.Top());r=Math.abs(t.Left()-n.Left());r>110&&r<130&&t.Left(n.Left()+120*u)};events.OnCanvasMouseMove=function(n){var i=getMouse(n),r,u,f,t,e;models.ui_state.dragging_handle?(models.ui_state.dragging_handle.node.Top(i.y-models.ui_state.dragging_handle.y),models.ui_state.dragging_handle.node.Left(i.x-models.ui_state.dragging_handle.x),r=!1,models.ui_state.dragging_handle.node.GetReceiverPoint&&(u=models.ui_state.dragging_handle.node.GetReceiverPoint(),t=models.GetNodeInSuggestionRange(u.x,u.y,!0,models.ui_state.dragging_handle.node.Id),t&&models.ui_state.dragging_handle.node.IsInputAllowed()===!0&&models.ui_state.dragging_handle.node.Inputs.indexOf(t.Id)==-1?(models.SuggestedConnection.FromNodeId(t.Id),models.SuggestedConnection.ToNodeId(models.ui_state.dragging_handle.node.Id),models.SuggestedConnection.IsVisible(!0),r=!0):models.SuggestedConnection.IsVisible(!1),t!=null&&snapToNode(t,models.ui_state.dragging_handle.node)),r===!1&&models.ui_state.dragging_handle.node.GetTransmitterPoint&&(f=models.ui_state.dragging_handle.node.GetTransmitterPoint(),t=models.GetNodeInSuggestionRange(f.x,f.y,!1,models.ui_state.dragging_handle.node.Id),t&&t.IsInputAllowed()===!0&&t.Inputs.indexOf(models.ui_state.dragging_handle.node.Id)==-1?(models.SuggestedConnection.FromNodeId(models.ui_state.dragging_handle.node.Id),models.SuggestedConnection.ToNodeId(t.Id),models.SuggestedConnection.IsVisible(!0)):models.SuggestedConnection.IsVisible(!1),t!=null&&snapToNode(t,models.ui_state.dragging_handle.node,!0))):models.ui_state.connecting_handle?(models.ui_state.connector.EndX(i.x),models.ui_state.connector.EndY(i.y)):(e=models.GetNodeAt(i.x,i.y),e!=null?$("html,body").css("cursor","move"):$("html,body").css("cursor",""))};events.FetchSelectedNodeData=function(n,t){if(models.SelectedNode()!=null&&models.SelectedNode().IsConfigured()===!0)if(models.SelectedNodeHasRender()===!1){var i=models.SelectedNode().Id;models.SelectedNodeStatus("not_ready");n=n||0;t=t||models.DataPageSize();backend.LoadData(models.ServerQueryKey,models.GetCoreNodeSettings(),models.SelectedNode().Id,n,t,"JSON",null,function(t){t.status&&models.SelectedNode()&&models.SelectedNode().Id===i&&(models.SelectedNodeStatus(t.status),models.SelectedNode().SetColumns(t.columns,t.columnTypes),t.status==="ok"&&(models.CurrentData(t.rows),models.CurrentRowStart(n+1),models.CurrentRowEnd(n+t.rows.length),models.CurrentRowsTotal(t.rowCount),models.CurrentDataColumns(t.columns)),t.status==="error"&&models.SelectedNode().ErrorText("Something went wrong while trying to fetch the data. Please contact an administrator."))})}else models.CurrentData(null),models.CurrentRowStart(null),models.CurrentRowEnd(null),models.CurrentRowsTotal(null),models.CurrentDataColumns(null),models.SelectedNode().RenderResults($("#nonTabularResultsContainer > div[data-results-node-id='"+models.SelectedNode().Id+"']"),models)};events.SelectNode=function(n){models.SelectedNode(n);models.SelectedNodeStatus(null);models.CurrentData(null);models.CurrentRowStart(0);models.CurrentRowEnd(null);models.CurrentRowsTotal(null);n!=null&&n.OnSelected(models)};events.OnCanvasMouseUp=function(n){var i=!1,u=getMouse(n),r,t;models.ui_state.dragging_handle?(models.SelectedNode()!=models.ui_state.dragging_handle.node&&(events.SelectNode(models.ui_state.dragging_handle.node),events.FetchSelectedNodeData(0,models.DataPageSize())),models.SuggestedConnection.IsVisible()&&(r=models.GetNodeById(models.SuggestedConnection.ToNodeId()),r.Inputs.push(models.SuggestedConnection.FromNodeId()),r.OnInputsUpdated(models),models.SuggestedConnection.IsVisible(!1),i=!0)):events.SelectNode(null);models.ui_state.dragging_handle=null;models.ui_state.connecting_handle?(t=models.GetNodeConnectionHandle(u.x,u.y,models.ui_state.connecting_handle.type),t&&t.node.IsInputAllowed()&&models.IsCircularDependency(models.ui_state.connecting_handle.node,t.node)==!1&&(models.ui_state.connecting_handle.type=="input"?(models.ui_state.connecting_handle.node.Inputs.push(t.node.Id),models.ui_state.connecting_handle.node.OnInputsUpdated(models)):(t.node.Inputs.push(models.ui_state.connecting_handle.node.Id),t.node.OnInputsUpdated(models)),i=!0),models.ui_state.connecting_handle=null,models.ui_state.connector.IsVisible(!1)):models.ui_state.selecting_connector?models.SelectedConnector(models.ui_state.selecting_connector):models.SelectedConnector(null);models.ui_state.selecting_connector=null;i&&backend.SaveQuery(models.ServerQueryKey,models.GetCoreNodeSettings())};events.OnCanvasMouseDown=function(n){var t=getMouse(n);models.ui_state.dragging_handle=models.GetNodeDragHandle(t.x,t.y);models.ui_state.dragging_handle==null&&(models.ui_state.connecting_handle=models.GetNodeConnectionHandle(t.x,t.y),models.ui_state.connecting_handle?(models.ui_state.connector.StartX(t.x),models.ui_state.connector.StartY(t.y),models.ui_state.connector.EndX(t.x),models.ui_state.connector.EndY(t.y),models.ui_state.connector.IsVisible(!0)):models.ui_state.selecting_connector=models.GetConnectorAt(t.x,t.y))};events.OnCanvasDoubleClick=function(){models.SelectedNode()!=null&&events.ShowOptionsDialog();$("html,body").css("cursor","")};events.UpdateSelectedNodeOptions=function(){var n=models.SelectedNode();n&&n.OnOptionsUpdated(models)};events.ActiveOptionsModalOK=function(){events.UpdateSelectedNodeOptions();var n=$(".modal[data-node-id='"+models.SelectedNode().Id+"']");n.modal("hide");backend.SaveQuery(models.ServerQueryKey,models.GetCoreNodeSettings(),function(){events.FetchSelectedNodeData()})};events.ActiveOptionsModalRemove=function(){var n=$(".modal[data-node-id='"+models.SelectedNode().Id+"']");n.modal("hide");events.DeleteSelectedObject()};events.ShowOptionsDialog=function(){var n=$(".modal[data-node-id='"+models.SelectedNode().Id+"']");n.modal()};events.DeleteSelectedObject=function(){models.SelectedNode()!=null?($("#node_options_container > div[data-node-id='"+models.SelectedNode().Id+"']").remove(),models.RemoveNode(models.SelectedNode().Id)):models.SelectedConnector()!=null&&models.RemoveConnector(models.SelectedConnector().fromNodeId,models.SelectedConnector().toNodeId);backend.SaveQuery(models.ServerQueryKey,models.GetCoreNodeSettings())};events.PagerStart=function(){models.SelectedNode()!=null&&events.FetchSelectedNodeData(0,models.DataPageSize())};events.PagerEnd=function(){var n,t;models.SelectedNode()!=null&&(n=parseInt(models.CurrentRowsTotal()/models.DataPageSize())*models.DataPageSize(),n==models.CurrentRowsTotal()&&(n-=models.DataPageSize()),t=models.CurrentRowsTotal()-n,events.FetchSelectedNodeData(n,t))};events.PagerNext=function(){models.SelectedNode()!=null&&events.FetchSelectedNodeData(models.CurrentRowStart()-1+models.DataPageSize(),models.DataPageSize())};events.PagerPrev=function(){models.SelectedNode()!=null&&events.FetchSelectedNodeData(models.CurrentRowStart()-1-models.DataPageSize(),models.DataPageSize())};events.OnKeyUp=function(n){if($(document.activeElement).is("body")&&(n.which===46||n.which===8))return events.DeleteSelectedObject(),!1};events.OnKeyPress=function(n){if(n.which===13)return $("button.ui-state-focus").click(),!1};views={};getConnectorParameters=function(n,t){var i=n.GetTransmitterPoint(),r=t.GetReceiverPoint();return getConnectorParametersFromCoords(i.x,i.y,r.x,r.y)};getConnectorParametersFromCoords=function(n,t,i,r){return{Top:Math.min(t,r)+Math.abs(r-t)/2,Left:Math.min(n,i)+Math.abs(i-n)/2,Height:Math.abs(r-t),Width:Math.abs(i-n),StartX:Math.abs(Math.min(0,i-n)),StartY:Math.abs(Math.min(0,r-t)),CurvePointX:Math.abs(i-n)/2,CurvePointY:0,EndX:Math.abs(Math.max(0,i-n)),EndY:Math.abs(Math.max(0,r-t)),EndPointX:i,EndPointY:r}};views.RenderToolbarSymbol=function(n,t){var r=t().SymbolPath,i=new fabric.StaticCanvas(n),u=new fabric.Path(r,{top:16,left:16,height:32,width:32,strokeWidth:0,fill:"#d9d9d9"});i.add(u);i.renderAll()};_dragged=null;views.RenderDraggableToolbarButton=function(n,t){$(n).draggable({helper:function(){var i=$("<div><\/div>").text(t().Title);return $(n).append(i),i},drag:function(n,t){events.OnToolDrag(n,t,_dragged)},start:function(){_dragged=t();$("#dropTarget").text(_dragged.Title).show()},stop:function(){models.SuggestedConnection.IsVisible(!1);$("#dropTarget").hide()}})};views.RenderDroppableArea=function(n){$(n).droppable({drop:function(n,t){_dragged!=null&&(events.OnToolDrop(n,t,_dragged),_dragged=null)}})};views.CreateWorkspace=function(){var n=$("#workspace");$("#workspace_canvas").attr("width",n.width()).attr("height",n.height());n[0].onselectstart=function(){return!1};models.ui_state.workspace_canvas=new fabric.StaticCanvas("workspace_canvas")};drawOrUpdateConnector=function(n,t,i,r,u,f,e,o){if(n===!0){var s=getConnectorParametersFromCoords(t,i,r,u);f.path?(f.path.path[0][1]=s.StartX,f.path.path[0][2]=s.StartY,f.path.path[1][1]=s.CurvePointX,f.path.path[1][2]=s.CurvePointY,f.path.path[1][3]=s.EndX,f.path.path[1][4]=s.EndY,f.path.set("top",s.Top),f.path.set("left",s.Left),f.path.set("height",s.Height),f.path.set("width",s.Width),f.circle.set("top",u),f.circle.set("left",r)):(f.path=new fabric.Path("M"+s.StartX+" "+s.StartY+" Q"+s.CurvePointX+","+s.CurvePointY+" "+s.EndX+","+s.EndY,{strokeWidth:2,stroke:e,fill:"",top:s.Top,left:s.Left,height:s.Height,width:s.Width}),f.circle=new fabric.Circle({top:s.EndPointY,left:s.EndPointX,strokeWidth:1,radius:4,fill:e,stroke:"none"}),f.circle.hasBorders=!1,models.ui_state.workspace_canvas.add(f.circle),models.ui_state.workspace_canvas.add(f.path),o?(models.ui_state.workspace_canvas.bringToFront(f.circle),models.ui_state.workspace_canvas.bringToFront(f.path)):(models.ui_state.workspace_canvas.sendToBack(f.circle),models.ui_state.workspace_canvas.sendToBack(f.path)));models.ui_state.workspace_canvas.renderAll()}else f.path&&(models.ui_state.workspace_canvas.remove(f.path),models.ui_state.workspace_canvas.remove(f.circle)),f.path=null,f.circle=null};views.RedrawConnector=function(){drawOrUpdateConnector(models.ui_state.connector.IsVisible(),models.ui_state.connector.StartX(),models.ui_state.connector.StartY(),models.ui_state.connector.EndX(),models.ui_state.connector.EndY(),models.ui_state.connector,"#900",!0)};views.RedrawSuggestedConnector=function(){drawOrUpdateConnector(models.SuggestedConnection.IsVisible(),models.SuggestedConnection.FromPoint().X,models.SuggestedConnection.FromPoint().Y,models.SuggestedConnection.ToPoint().X,models.SuggestedConnection.ToPoint().Y,models.SuggestedConnection,"#a6a6a6",!1)};views.RedrawWorkspace=function(){$.each(models.current_nodes(),function(n,t){t.Inputs&&$.each(t.Inputs(),function(n,i){var f,r,u;t.inputPaths==undefined&&(t.inputPaths={},t.inputCircles={});f=models.GetNodeById(i);f!=null&&(r=getConnectorParameters(f,t),t.inputPaths[i]?(u=t.inputPaths[i],u.path[0][1]=r.StartX,u.path[0][2]=r.StartY,u.path[1][1]=r.CurvePointX,u.path[1][2]=r.CurvePointY,u.path[1][3]=r.EndX,u.path[1][4]=r.EndY,u.set("top",r.Top),u.set("left",r.Left),u.set("height",r.Height),u.set("width",r.Width),circle=t.inputCircles[i],circle.set("top",r.EndPointY),circle.set("left",r.EndPointX)):(t.inputPaths[i]=new fabric.Path("M"+r.StartX+" "+r.StartY+" Q"+r.CurvePointX+","+r.CurvePointY+" "+r.EndX+","+r.EndY,{strokeWidth:2,stroke:"#666",fill:"",top:r.Top,left:r.Left,height:r.Height,width:r.Width}),models.ui_state.workspace_canvas.add(t.inputPaths[i]),models.ui_state.workspace_canvas.sendToBack(t.inputPaths[i]),t.inputCircles[i]=new fabric.Circle({top:r.EndPointY,left:r.EndPointX,strokeWidth:1,radius:4,fill:"#666",stroke:"none"}),t.inputCircles[i].hasBorders=!1,models.ui_state.workspace_canvas.add(t.inputCircles[i]),models.ui_state.workspace_canvas.sendToBack(t.inputCircles[i])))})});$.each(models.current_nodes(),function(n,t){var r,u,s,f,h,e,i,o;t.iconGroup?(t.iconGroup.top=t.Top()+40,t.iconGroup.left=t.Inputs?t.Type==="DataSource"||t.Type==="DataProcessor"?t.Left()+24:t.Left()+16:t.Left()+32,r=t.iconGroup.getObjects()[2],r.getText()!==t.Name()&&r.setText(t.Name())):(t.iconGroup=new fabric.Group,t.iconGroup.hasControls=!1,t.iconGroup.hasBorders=!1,u="#fff",t==models.SelectedNode()&&(u="#ccf"),s=new fabric.Rect({top:t.Top()+24,left:t.Left()+24,height:48,width:48,stroke:"#111",strokeWidth:3,rx:5,ry:5,fill:u}),t.iconGroup.add(s),f=new fabric.Path(t.SymbolPath,{top:t.Top()+24,left:t.Left()+24,fill:"#111",width:32,height:32}),f.scale(1.5),t.iconGroup.add(f),h=new fabric.Text(t.Name(),{fontFamily:"Delicious_500",left:t.Left()+32,top:t.Top()+68,width:64,height:24,fontSize:18,textAlign:"Center",fill:"#111"}),t.iconGroup.add(h),(t.Type==="DataSource"||t.Type==="DataProcessor")&&(i=new fabric.Line([t.Left()+48,t.Top()+24,t.Left()+60,t.Top()+24],{strokeWidth:3}),t.iconGroup.add(i),e=new fabric.Circle({top:t.Top()+24,left:t.Left()+60,strokeWidth:3,radius:4,fill:"#f00",stroke:"#111"}),e.hasBorders=!1,t.iconGroup.add(e)),t.Inputs&&(i=new fabric.Line([t.Left()-8,t.Top()+24,t.Left(),t.Top()+24],{strokeWidth:3}),t.iconGroup.add(i),o=new fabric.Path("M4 0 a4 4 0 0 1 0 8",{top:t.Top()+24,left:t.Left()-12,fill:"none",width:8,height:8,stroke:"#111",strokeWidth:3}),o.hasBorders=!1,t.iconGroup.add(o)),models.ui_state.workspace_canvas.add(t.iconGroup))});models.ui_state.workspace_canvas.renderAll()};_dataSubscription=null;views.UpdateSelectedConnector=function(n){if(n){var t=models.GetNodeById(n.toNodeId);t.inputPaths&&(t.inputPaths[n.fromNodeId].set("stroke","#900"),t.inputCircles[n.fromNodeId].set("fill","#900"))}else $.each(models.current_nodes(),function(n,t){if(t.inputPaths)for(var i in t.inputPaths)t.inputPaths[i].set("stroke","#666"),t.inputCircles[i].set("fill","#666")});models.ui_state.workspace_canvas.renderAll()};views.UpdateSelectedNode=function(n){n?(n.iconGroup&&n.iconGroup.item(0).set("fill","#ccf"),$.each(models.current_nodes(),function(t,i){i!=n&&i.iconGroup&&i.iconGroup.item(0).set("fill","#fff")}),models.ui_state.workspace_canvas.renderAll()):($.each(models.current_nodes(),function(n,t){t.iconGroup&&t.iconGroup.item(0).set("fill","#fff")}),models.ui_state.workspace_canvas.renderAll())};views.RenderSelectedNodeResults=function(n,t){var i,r;$(n).children().hide();i=t();i()&&i().RenderResults&&(r=$(n).find("div[data-results-node-id='"+i().Id+"']"),r.length===0&&(r=$("<div id='result_container_"+i().Id+"' data-results-node-id='"+i().Id+"'><\/div>"),$(n).append(r)),r.show())};views.RenderDraggableColumn=function(n){$(n).draggable({connectToSortable:".connectedColumnList",helper:"clone",revert:"invalid",start:function(n,t){$(t.helper).width($(t.helper).prev().width())}})};views.RenderSortableColumnList=function(n,t,i,r){var u=t(),e=$(n),f=u.data,o={connectWith:".connectedColumnList",dropOnEmpty:!0,revert:!0,start:function(n,t){t.item.hasClass("selectedColumn")&&(r.removeAt=t.item.prevAll().length)},stop:function(n,t){if(r.removeAt!=null){if(u.onMove!=null)u.onMove(r.removeAt,t.item.prevAll().length);f.splice(r.removeAt,1);f.splice(t.item.prevAll().length,0,parseInt(t.item.attr("data-bind-col-index")));t.item.remove();r.removeAt=null}},receive:function(n,t){if(u.onDrop!=null)u.onDrop(i,parseInt(t.item.attr("data-bind-col-index")));var i=$(this).children(".availableColumn").prevAll().length;f.splice(i,0,parseInt(t.item.attr("data-bind-col-index")));$(n.target).children(".availableColumn").remove()}};e.sortable(o).disableSelection()};views.DatePickerInit=function(n,t,i){var u=i().datepickerOptions||{},r=$(n),f=function(){var n=t();n(r.datepicker("getDate"))};u.onSelect=f;r.change(f);r.mask("9999-99-99");r.datepicker(u);ko.utils.domNodeDisposal.addDisposeCallback(n,function(){r.datepicker("destroy")})};views.DatePickerUpdate=function(n,t){var i=ko.utils.unwrapObservable(t()),r=$(n),u;String(i).indexOf("/Date(")==0&&(i=new Date(parseInt(i.replace(/\/Date\((.*?)\)\//gi,"$1"))));u=r.datepicker("getDate");i!=undefined&&i-u!=0&&r.datepicker("setDate",i)};views.TimePickerInit=function(n){var t=$(n);t.mask("99:99")};views.TimePickerUpdate=function(){};views.NumericInputInit=function(n,t){$(n).numeric();$(n).change(function(){var i=t();i(parseFloat($(n).val()))})};views.NumericInputUpdate=function(n,t){var i=ko.utils.unwrapObservable(t()),r=$(n),u=parseFloat(r.val());i!=undefined&&i-u!=0&&r.val(i)};ko.bindingHandlers.canvas_symbol={init:views.RenderToolbarSymbol};ko.bindingHandlers.draggable_tool={init:views.RenderDraggableToolbarButton};ko.bindingHandlers.droppable_area={init:views.RenderDroppableArea};ko.bindingHandlers.draw_nodes={init:views.CreateWorkspace,update:views.RedrawWorkspace};ko.bindingHandlers.render_options={update:views.RenderOptions};ko.bindingHandlers.render_results={update:views.RenderSelectedNodeResults};ko.bindingHandlers.draggable_column={init:views.RenderDraggableColumn};ko.bindingHandlers.draggable_column_trash={init:views.RenderDraggaleColumnTrash};ko.bindingHandlers.sortable_column_list={init:views.RenderSortableColumnList};ko.bindingHandlers.datepicker={init:views.DatePickerInit,update:views.DatePickerUpdate};ko.bindingHandlers.timepicker={init:views.TimePickerInit,update:views.TimePickerUpdate};ko.bindingHandlers.numeric={init:views.NumericInputInit,update:views.NumericInputUpdate};$(document).ready(function(){$("input:text").focus(function(){$(this).select()});$("#workspace_canvas").bind("touchmove",events.OnCanvasMouseMove);$("#workspace_canvas").mousemove(events.OnCanvasMouseMove);$("#workspace_canvas").bind("touchstart",events.OnCanvasMouseDown);$("#workspace_canvas").mousedown(events.OnCanvasMouseDown);$("#workspace_canvas").bind("touchend",events.OnCanvasMouseUp);$("#workspace_canvas").mouseup(events.OnCanvasMouseUp);$("#workspace_canvas").dblclick(events.OnCanvasDoubleClick);$(window).resize(events.OnWindowResize);models.ui_state.connector.IsVisible.subscribe(views.RedrawConnector);models.ui_state.connector.StartX.subscribe(views.RedrawConnector);models.ui_state.connector.StartY.subscribe(views.RedrawConnector);models.ui_state.connector.EndX.subscribe(views.RedrawConnector);models.ui_state.connector.EndY.subscribe(views.RedrawConnector);models.SuggestedConnection.FromPoint.subscribe(views.RedrawSuggestedConnector);models.SuggestedConnection.ToPoint.subscribe(views.RedrawSuggestedConnector);models.SuggestedConnection.IsVisible.subscribe(views.RedrawSuggestedConnector);models.SelectedNode.subscribe(views.UpdateSelectedNode);models.SelectedConnector.subscribe(views.UpdateSelectedConnector);$("#showConfig").click(events.ShowOptionsDialog);$("#showQuery").click(events.ShowQueryForSelectedObject);$("#delete").click(events.DeleteSelectedObject);$(".notificationBar > .closeButton").click(function(){$(this).parent().slideUp("slow")});$("#PagerStart").click(events.PagerStart);$("#PagerPrev").click(events.PagerPrev);$("#PagerNext").click(events.PagerNext);$("#PagerEnd").click(events.PagerEnd);$(window).keyup(events.OnKeyUp);$(window).keypress(events.OnKeyPress);models.ResultsOnly($.QueryString.resultsOnly=="true");models.SelectedNode()!=null&&events.FetchSelectedNodeData();ko.applyBindings(models,$("#binding-root")[0]);$("#resize_bar").draggable({helper:function(){return $("<div class='bottomPanelResizer'><\/div>")},axis:"y",create:events.SetBottomPanelSize,stop:events.OnBottomPanelResize});$("div#bottom_left_panel").show();events.OnWindowResize()});var getQuery=function(){var n={Nodes:[]};return $.each(models.current_nodes(),function(t,i){n.Nodes.push(i.GetSaveSettings())}),models.SelectedNode()!=null&&(n.SelectedNodeId=models.SelectedNode().Id),JSON.stringify(n)},loadNode=function(n,t){var r=n.findTool(t.Type),i;r&&(i=r.createNode(t.Name,t.Top,t.Left,t.Id),i.LoadSettings(t,n),n.current_nodes.push(i))},loadQuery=function(n,t,i){var f,r,u,e;for(t.RemoveEverything(),f=JSON.parse(i),r=[],$.each(f.Nodes,function(n,i){i.Type=="Data Table"?loadNode(t,i):r.push(i)});r.length>0;)u=r.splice(0,1)[0],e=!0,u.Inputs!=null&&$.each(u.Inputs,function(n,i){var f=t.GetNodeById(i),o=r.find(function(n){return n.Id==i});if(f==null&&o!=null)return r.push(u),e=!1,!1}),e==!0&&loadNode(t,u);$.each(t.current_nodes(),function(t,i){n.LoadNodeOptionsTemplate(i)});f.SelectedNodeId&&(n.SelectNode(t.GetNodeById(f.SelectedNodeId)),n.FetchSelectedNodeData())};
//# sourceMappingURL=aqb.min.js.map